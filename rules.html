<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>تمارين شد الجولاين - الفك واللغلوغ</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        /* الحفاظ على نفس أنماط القوائم */
        .rule-item ul {
            list-style: none;
            padding-right: 0;
            margin-top: 10px;
        }
        .rule-item ul li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        .rule-section-title {
            margin-top: 20px;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.2rem;
            border-bottom: 2px solid #aaa;
            padding-bottom: 5px;
        }
        .highlight {
            font-weight: bold;
            color: #cc0000;
        }
        /* تنسيق بسيطة للبروفايل داخل الهيدر */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #00be9f;
        }
        .user-details span {
            display: block;
            font-weight: bold;
            color: #fff;
        }
        .logout-btn {
            background: transparent;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 1.1rem;
        }
        .login-btn {
            background-color: #00be9f;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }
        .login-btn i {
            font-size: 1.2rem;
        }
        
        /* الأنماط الجديدة لتمارين شد الجولاين */
        .goolain-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .goolain-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 3px solid #00be9f;
            box-shadow: 0 10px 30px rgba(0, 190, 159, 0.1);
        }
        
        .goolain-title {
            color: #00be9f;
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* قسم الكاميرا والكوتش */
        .camera-coach-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            margin: 0 auto;
            border-radius: 10px;
            overflow: hidden;
        }
        
        #videoElement {
            width: 100%;
            height: 350px;
            background: #000;
            object-fit: cover;
        }
        
        .face-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .face-guide {
            position: absolute;
            width: 200px;
            height: 250px;
            border: 3px solid #00be9f;
            border-radius: 50% 50% 40% 40%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.7;
        }
        
        .jaw-line {
            position: absolute;
            bottom: 30%;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 2px;
            background: #ff416c;
            opacity: 0.6;
        }
        
        .neck-line {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 2px;
            background: #4CAF50;
            opacity: 0.6;
        }
        
        .controls-section {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .goolain-btn {
            background: linear-gradient(45deg, #00be9f, #009688);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .goolain-btn:hover {
            background: linear-gradient(45deg, #00d4b1, #00be9f);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 190, 159, 0.4);
        }
        
        .goolain-btn.secondary {
            background: linear-gradient(45deg, #666, #444);
        }
        
        .goolain-btn.danger {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
        }
        
        .goolain-btn.success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
        }
        
        .goolain-btn.warning {
            background: linear-gradient(45deg, #ff9800, #ff5722);
        }
        
        /* قسم الكوتش */
        .coach-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 20px;
        }
        
        .coach-avatar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .coach-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #00be9f;
        }
        
        .coach-info h3 {
            color: #00be9f;
            margin-bottom: 5px;
        }
        
        .coach-info p {
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .coach-message {
            background: rgba(0, 190, 159, 0.2);
            padding: 15px;
            border-radius: 10px;
            border-right: 5px solid #00be9f;
            margin-bottom: 20px;
            animation: pulseMessage 2s infinite;
        }
        
        @keyframes pulseMessage {
            0% { border-right-color: #00be9f; }
            50% { border-right-color: #00d4b1; }
            100% { border-right-color: #00be9f; }
        }
        
        /* قسم التمارين والGIF */
        .exercises-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 1.5rem;
        }
        
        .exercise-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .category-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            color: #ccc;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-btn.active {
            background: rgba(0, 190, 159, 0.3);
            border-color: #00be9f;
            color: white;
        }
        
        .gif-container {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .exercise-gif {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
        }
        
        .exercise-details {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
        }
        
        .exercise-name {
            color: #00be9f;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .exercise-description {
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .instructions-list {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .instructions-list li {
            margin-bottom: 8px;
            padding-right: 10px;
            position: relative;
        }
        
        .instructions-list li:before {
            content: "•";
            color: #00be9f;
            font-size: 1.2rem;
            position: absolute;
            right: -5px;
        }
        
        /* قسم المؤقت والتقييم */
        .timer-section {
            text-align: center;
            margin: 25px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }
        
        #timer {
            font-size: 3.5rem;
            color: #00be9f;
            font-weight: bold;
            font-family: monospace;
            text-shadow: 0 0 10px rgba(0, 190, 159, 0.3);
        }
        
        .timer-label {
            font-size: 1.3rem;
            color: #ccc;
            margin-top: 10px;
        }
        
        /* قسم التقييم الذكي */
        .evaluation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .eval-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .eval-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #00be9f;
            margin-bottom: 10px;
        }
        
        .eval-label {
            color: #ccc;
            font-size: 1rem;
        }
        
        .progress-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            position: relative;
        }
        
        .circle-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 8;
        }
        
        .circle-progress {
            fill: none;
            stroke: #00be9f;
            stroke-width: 8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 1s ease;
        }
        
        .circle-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
        }
        
        /* قسم النتائج */
        .results-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 30px;
        }
        
        .score-display {
            text-align: center;
            margin: 30px 0;
        }
        
        .final-score {
            font-size: 5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00be9f, #4CAF50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .score-label {
            font-size: 1.5rem;
            color: #ccc;
        }
        
        .feedback-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feedback-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            border-top: 5px solid;
        }
        
        .feedback-card.good {
            border-top-color: #4CAF50;
        }
        
        .feedback-card.warning {
            border-top-color: #ff9800;
        }
        
        .feedback-card.bad {
            border-top-color: #f44336;
        }
        
        .feedback-card h4 {
            color: white;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feedback-card p {
            color: #ccc;
            line-height: 1.6;
        }
        
        /* الإشعارات */
        .notification {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #00be9f, #009688);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            box-shadow: 0 10px 25px rgba(0, 190, 159, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 90%;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        /* أدوات الوجه */
        .face-tools {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        
        .face-tool {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .face-tool:hover {
            background: rgba(0, 190, 159, 0.7);
            transform: scale(1.1);
        }
        
        /* رحلة التقدم */
        .journey-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 30px;
        }
        
        .journey-timeline {
            position: relative;
            margin-top: 30px;
        }
        
        .journey-line {
            position: absolute;
            top: 30px;
            right: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #00be9f, transparent);
        }
        
        .journey-milestones {
            display: flex;
            justify-content: space-between;
            position: relative;
            z-index: 2;
        }
        
        .milestone {
            text-align: center;
            width: 100px;
        }
        
        .milestone-dot {
            width: 25px;
            height: 25px;
            background: #666;
            border-radius: 50%;
            margin: 0 auto 10px;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .milestone.active .milestone-dot {
            background: #00be9f;
            border-color: white;
            box-shadow: 0 0 15px rgba(0, 190, 159, 0.5);
        }
        
        .milestone.reached .milestone-dot {
            background: #4CAF50;
            border-color: white;
        }
        
        .milestone-label {
            color: #ccc;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
<header class="glass">
    <div class="auth-status">
        <!-- زر الموسيقى -->
        <button onclick="openMusicPlayer()" class="music-btn" title="مشغل الموسيقى">
            <i class="fas fa-music"></i>
        </button>
        
        <!-- حالة المستخدم -->
        <span id="userInfo" style="display: none;">
            <div class="user-profile">
                <img id="userAvatar" src="default-avatar.png" alt="صورة المستخدم" class="user-avatar" />
                <div class="user-details">
                    <span id="displayName"></span>
                </div>
                <button onclick="logout()" class="logout-btn" title="تسجيل خروج">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </span>
        
        <!-- زر تسجيل الدخول -->
        <button onclick="redirectToLogin()" id="loginBtn" class="login-btn">
            <i class="fas fa-sign-in-alt"></i> تسجيل دخول
        </button>
    </div>

    <nav>
        <!-- قائمة التنقل -->
        <ul>
            <li><a href='index.html'><i class="fas fa-home"></i> الرئيسية</a></li>
            <li><a href='features.html'><i class="fas fa-star"></i> مدرب رياضي</a></li>
            <li><a href='rules.html'><i class="fas fa-gavel"></i> شد الجولاين</a></li>
            <li><a class='active' href='download.html'><i class="fas fa-download"></i> qr code </a></li>
            <li><a href='apply.html'><i class="fas fa-user-shield"></i> طبيب الكتروني </a></li>
            <li><a href='faq.html'><i class="fas fa-question-circle"></i> دردشة الخبراء</a></li>
            <li><a href='shop.html'><i class="fas fa-store"></i> العبقري الذكي </a></li>
        </ul>
    </nav>
</header>

<main class="goolain-container">
    <div class="goolain-card">
        <h1 class="goolain-title">
            <i class="fas fa-user-md"></i> نظام شد الجولاين - الفك واللغلوغ
        </h1>
        
        <div class="main-grid">
            <!-- القسم الأيمن: الكاميرا والكوتش -->
            <div>
                <div class="camera-coach-section">
                    <h3><i class="fas fa-video"></i> كاميرا تحليل الوجه والرقبة</h3>
                    
                    <div class="camera-container">
                        <div class="face-tools">
                            <button class="face-tool" onclick="toggleJawLine()" title="خط الفك">
                                <i class="fas fa-vector-square"></i>
                            </button>
                            <button class="face-tool" onclick="toggleNeckLine()" title="خط الرقبة">
                                <i class="fas fa-neck"></i>
                            </button>
                            <button class="face-tool" onclick="toggleSymmetry()" title="التناسق">
                                <i class="fas fa-balance-scale"></i>
                            </button>
                        </div>
                        
                        <video id="videoElement" autoplay></video>
                        
                        <div class="face-overlay">
                            <div class="face-guide"></div>
                            <div class="jaw-line" id="jawLine"></div>
                            <div class="neck-line" id="neckLine"></div>
                        </div>
                    </div>
                    
                    <div class="controls-section">
                        <button class="goolain-btn success" onclick="startCamera()">
                            <i class="fas fa-video"></i> تشغيل الكاميرا
                        </button>
                        <button class="goolain-btn warning" onclick="startExercise()" id="startBtn" disabled>
                            <i class="fas fa-play"></i> بدء التمرين
                        </button>
                        <button class="goolain-btn danger" onclick="stopExercise()" id="stopBtn" disabled>
                            <i class="fas fa-stop"></i> إيقاف التمرين
                        </button>
                        <button class="goolain-btn secondary" onclick="stopCamera()">
                            <i class="fas fa-power-off"></i> إيقاف الكاميرا
                        </button>
                    </div>
                </div>
                
                <!-- الكوتش الذكي -->
                <div class="coach-container">
                    <div class="coach-avatar">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Coach&backgroundColor=00be9f" 
                             alt="الكوتش الذكي" class="coach-img">
                        <div class="coach-info">
                            <h3>كوتش الذكاء الاصطناعي</h3>
                            <p>مدرب محترف في تمارين شد الجولاين والوجه</p>
                        </div>
                    </div>
                    
                    <div class="coach-message" id="coachMessage">
                        <i class="fas fa-microphone-alt"></i>
                        <span id="messageText">مرحباً! أنا كوتشك الذكي. سأساعدك في تمارين شد الفك واللغلوغ. اضغط على "تشغيل الكاميرا" للبدء.</span>
                    </div>
                    
                    <div class="controls-section">
                        <button class="goolain-btn" onclick="askCoach('نصائح')">
                            <i class="fas fa-lightbulb"></i> نصائح سريعة
                        </button>
                        <button class="goolain-btn" onclick="askCoach('وضعية')">
                            <i class="fas fa-user-check"></i> تحليل الوضعية
                        </button>
                        <button class="goolain-btn secondary" onclick="askCoach('تغذية')">
                            <i class="fas fa-apple-alt"></i> نصائح غذائية
                        </button>
                    </div>
                </div>
                
                <!-- المؤقت والتقييم الفوري -->
                <div class="timer-section">
                    <div id="timer">00:00:00</div>
                    <div class="timer-label">وقت التمرين الحالي</div>
                    
                    <div class="evaluation-grid" style="margin-top: 20px;">
                        <div class="eval-card">
                            <div class="progress-circle">
                                <svg width="120" height="120">
                                    <circle class="circle-bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="circle-progress" id="jawProgress" cx="60" cy="60" r="50" 
                                            stroke-dasharray="314" stroke-dashoffset="314"></circle>
                                </svg>
                                <div class="circle-text" id="jawScore">0%</div>
                            </div>
                            <div class="eval-label">دقة خط الفك</div>
                        </div>
                        
                        <div class="eval-card">
                            <div class="progress-circle">
                                <svg width="120" height="120">
                                    <circle class="circle-bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="circle-progress" id="neckProgress" cx="60" cy="60" r="50" 
                                            stroke-dasharray="314" stroke-dashoffset="314"></circle>
                                </svg>
                                <div class="circle-text" id="neckScore">0%</div>
                            </div>
                            <div class="eval-label">تماسك الرقبة</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- القسم الأيسر: التمارين والGIF -->
            <div class="exercises-section">
                <h3><i class="fas fa-dumbbell"></i> تمارين شد الجولاين المتخصصة</h3>
                
                <div class="exercise-categories">
                    <button class="category-btn active" onclick="selectCategory('jaw')">تمارين الفك</button>
                    <button class="category-btn" onclick="selectCategory('neck')">تمارين الرقبة</button>
                    <button class="category-btn" onclick="selectCategory('face')">تمارين الوجه</button>
                    <button class="category-btn" onclick="selectCategory('relax')">تمارين الاسترخاء</button>
                </div>
                
                <div class="gif-container">
                    <img id="exerciseGif" class="exercise-gif" 
                         src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHN4NndyMHk4bzEyY2J1cjYxam4xNGkycW5pand5bjljbzhuNzdyMiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/96wrfvjuXCGKU24EzH/giphy.gif" 
                         alt="تمرين GIF">
                </div>
                
                <div class="exercise-details">
                    <h3 class="exercise-name" id="currentExerciseName">تمرين شد الفك الجانبي</h3>
                    <p class="exercise-description" id="currentExerciseDesc">
                        هذا التمرين يساعد على شد عضلات الفك الجانبية وإزالة الترهلات.
                        يعمل على تحسين خط الفك وإبرازه بشكل طبيعي.
                    </p>
                    
                    <div class="instructions-list" id="instructionsList">
                        <h4><i class="fas fa-list-ol"></i> خطوات التمرين:</h4>
                        <ul id="instructions">
                            <li>اجلس أو قف بوضعية مستقيمة</li>
                            <li>حرك فكك ببطء للجانب الأيمن</li>
                            <li>اثبت لمدة 5 ثواني</li>
                            <li>كرر للجانب الأيسر</li>
                            <li>أعد التمرين 10 مرات لكل جانب</li>
                        </ul>
                    </div>
                    
                    <div class="controls-section" style="margin-top: 20px;">
                        <button class="goolain-btn" onclick="previousExercise()">
                            <i class="fas fa-arrow-right"></i> التمرين السابق
                        </button>
                        <button class="goolain-btn success" onclick="nextExercise()">
                            <i class="fas fa-arrow-left"></i> التمرين التالي
                        </button>
                        <button class="goolain-btn warning" onclick="repeatExercise()">
                            <i class="fas fa-redo"></i> إعادة المشاهدة
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- رحلة التقدم -->
        <div class="journey-section">
            <h3><i class="fas fa-road"></i> رحلة تحسين الجولاين</h3>
            
            <div class="journey-timeline">
                <div class="journey-line"></div>
                <div class="journey-milestones">
                    <div class="milestone active" id="milestone1">
                        <div class="milestone-dot"></div>
                        <div class="milestone-label">الأسبوع ١</div>
                    </div>
                    <div class="milestone" id="milestone2">
                        <div class="milestone-dot"></div>
                        <div class="milestone-label">الأسبوع ٢</div>
                    </div>
                    <div class="milestone" id="milestone3">
                        <div class="milestone-dot"></div>
                        <div class="milestone-label">الأسبوع ٣</div>
                    </div>
                    <div class="milestone" id="milestone4">
                        <div class="milestone-dot"></div>
                        <div class="milestone-label">الأسبوع ٤</div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
                <button class="goolain-btn" onclick="saveProgress()">
                    <i class="fas fa-save"></i> حفظ التقدم اليومي
                </button>
                <button class="goolain-btn secondary" onclick="showProgressReport()">
                    <i class="fas fa-chart-bar"></i> عرض تقرير التقدم
                </button>
            </div>
        </div>
        
        <!-- النتائج والتقييم النهائي -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h3><i class="fas fa-trophy"></i> نتائج الجلسة التدريبية</h3>
            
            <div class="score-display">
                <div class="final-score" id="finalScore">0</div>
                <div class="score-label">/ 100 نقطة</div>
            </div>
            
            <div class="feedback-grid" id="feedbackGrid">
                <!-- سيتم ملؤها بالتعليقات -->
            </div>
            
            <div class="controls-section" style="margin-top: 30px;">
                <button class="goolain-btn success" onclick="shareResults()">
                    <i class="fas fa-share-alt"></i> مشاركة النتائج
                </button>
                <button class="goolain-btn" onclick="printCertificate()">
                    <i class="fas fa-certificate"></i> شهادة الإنجاز
                </button>
                <button class="goolain-btn secondary" onclick="scheduleNextSession()">
                    <i class="fas fa-calendar-plus"></i> جدولة الجلسة القادمة
                </button>
            </div>
        </div>
    </div>
</main>

<footer>
    <div class="copyright">
        جميع الحقوق محفوظة &copy; 2026
        <a href="https://www.instagram.com/talel_chebbi4?igsh=YzI5ZmEzbnpua2F5" target="_blank" rel="noopener noreferrer">By Daniel Ai</a>
    </div>
</footer>

<script>


        function openMusicPlayer() {
        window.open('music-player.html', 'MusicPlayer', 
            'width=450,height=700,left=100,top=100,resizable=yes,scrollbars=yes');
    }
    // ==== نظام تمارين شد الجولاين (الفك واللغلوغ) ====
    
    // المتغيرات الرئيسية
    let cameraStream = null;
    let exerciseActive = false;
    let exerciseTimer = null;
    let exerciseSeconds = 0;
    let currentCategory = 'jaw';
    let currentExerciseIndex = 0;
    let jawAccuracy = 0;
    let neckAccuracy = 0;
    let symmetryScore = 0;
    let totalScore = 0;
    
    // قاعدة بيانات التمارين
    const exercisesDB = {
        jaw: [
            {
                name: "تمرين شد الفك الجانبي",
                description: "تمرين فعال لشد عضلات الفك الجانبية وتحسين خط الفك. يساعد في التخلص من الترهلات الجانبية.",
                gif: "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3dXdsc2J3MnNuaGtyaXQyZ2xyMXlrZXl4dG9tNGRkZHcwMTBnZGtzaSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/DXblkHYQGTa17QDjgm/giphy.gif",
                instructions: [
                    "اجلس أو قف بوضعية مستقيمة مع استقامة الظهر",
                    "حرك فكك السفلي ببطء ناحية الجانب الأيمن",
                    "اثبت على هذه الوضعية لمدة 5-7 ثوان",
                    "اشعر بشد عضلات الفك والوجه",
                    "ارجع ببطء إلى الوضع الأصلي",
                    "كرر التمرين 10 مرات لكل جانب",
                    "تنفس بعمق خلال التمرين"
                ],
                benefits: [
                    "تحسين خط الفك الجانبي",
                    "تقوية عضلات المضغ",
                    "تخفيف ترهلات الجوانب",
                    "تحسين شكل الوجه"
                ]
            },
            {
                name: "تمرين دفع الفك الأمامي",
                description: "تمرين مهم لشد الفك السفلي وإبراز الذقن. يعمل على تقوية عضلات الفك الأمامية.",
                gif: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHN4NndyMHk4bzEyY2J1cjYxam4xNGkycW5pand5bjljbzhuNzdyMiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/eapuJ6TGZtxKae215G/giphy.gif",
                instructions: [
                    "أغلق فمك وضع لسانك خلف الأسنان العلوية",
                    "ادفع بفكك السفلي للأمام ببطء",
                    "اثبت لمدة 10 ثوان مع الشد",
                    "اشعر بشد في منطقة الذقن والرقبة",
                    "ارجع ببطء إلى الوضع الطبيعي",
                    "كرر 15 مرة ببطء",
                    "احرص على عدم إجهاد الفك"
                ],
                benefits: [
                    "إبراز الذقن",
                    "تقوية الفك السفلي",
                    "تحسين المظهر الجانبي",
                    "تقوية عضلات الرقبة"
                ]
            },
            {
                name: "تمرين فتح الفك الواسع",
                description: "تمرين لتحسين مرونة الفك وتقوية عضلات المضغ. يساعد في شد منطقة تحت الذقن.",
                gif: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHN4NndyMHk4bzEyY2J1cjYxam4xNGkycW5pand5bjljbzhuNzdyMiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/f5u4lf1SBqubtB88kz/giphy.gif",
                instructions: [
                    "افتح فمك بأقصى اتساع ممكن",
                    "اثبت لمدة 3-5 ثوان",
                    "أغلق فمك ببطء شديد",
                    "كرر التمرين 8-10 مرات",
                    "توقف إذا شعرت بأي ألم",
                    "أداء التمرين ببطء وتركيز",
                    "تنفس بعمق خلال التمرين"
                ],
                benefits: [
                    "تحسين مرونة الفك",
                    "شد منطقة تحت الذقن",
                    "تقوية عضلات المضغ",
                    "تحسين حركة الفك"
                ]
            }
        ],
        neck: [
            {
                name: "تمرين شد الرقبة الجانبي",
                description: "تمرين لشد عضلات الرقبة الجانبية وإزالة الترهلات. يحسن من مظهر اللغلوغ.",
                gif: "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3dXdsc2J3MnNuaGtyaXQyZ2xyMXlrZXl4dG9tNGRkZHcwMTBnZGtzaSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/DXblkHYQGTa17QDjgm/giphy.gif",
                instructions: [
                    "اجلس باستقامة مع شد الظهر",
                    "امل رأسك ناحية الكتف الأيمن",
                    "اثبت لمدة 10 ثوان مع الشد",
                    "ارجع ببطء إلى الوضع الأصلي",
                    "كرر للجهة اليسرى",
                    "أداء 10 مرات لكل جانب",
                    "حافظ على استقامة الكتفين"
                ],
                benefits: [
                    "شد عضلات الرقبة الجانبية",
                    "تقليل ترهل اللغلوغ",
                    "تحسين مرونة الرقبة",
                    "تخفيف آلام الرقبة"
                ]
            },
            {
                name: "تمرين دوران الرقبة",
                description: "تمرين شامل لتحسين مرونة الرقبة وتقوية عضلاتها. يساعد في تحسين الدورة الدموية.",
                gif: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHN4NndyMHk4bzEyY2J1cjYxam4xNGkycW5pand5bjljbzhuNzdyMiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/bck3nKeWyZskgezFf0/giphy.gif",
                instructions: [
                    "اجلس بوضعية مريحة",
                    "أدر رأسك ببطء في دائرة كاملة",
                    "ابدأ من اليمين إلى الخلف ثم اليسار",
                    "كرر 5 مرات في كل اتجاه",
                    "أداء التمرين ببطء شديد",
                    "توقف إذا شعرت بالدوار",
                    "تنفس بعمق خلال التمرين"
                ],
                benefits: [
                    "تحسين مرونة الرقبة",
                    "تقوية عضلات الرقبة",
                    "تحسين الدورة الدموية",
                    "تخفيف التوتر والضغط"
                ]
            },
            {
                name: "تمرين دفع الذقن",
                description: "تمرين ممتاز لشد منطقة تحت الذقن وإزالة اللغلوغ. يعمل على تحسين وضعية الرقبة.",
                gif: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHN4NndyMHk4bzEyY2J1cjYxam4xNGkycW5pand5bjljbzhuNzdyMiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/eapuJ6TGZtxKae215G/giphy.gif",
                instructions: [
                    "اجلس أو قف مع استقامة الظهر",
                    "ادفع ذقنك للخلف كما لو تحاول صنع ذقن مزدوج",
                    "اثبت لمدة 10-15 ثانية",
                    "اشعر بشد في مقدمة الرقبة",
                    "أعد الرقبة إلى الوضع الطبيعي",
                    "كرر 12-15 مرة",
                    "حافظ على استقامة الرأس"
                ],
                benefits: [
                    "إزالة اللغلوغ",
                    "تحسين وضعية الرقبة",
                    "شد منطقة تحت الذقن",
                    "تقوية عضلات الرقبة الأمامية"
                ]
            }
        ],
        face: [
            {
                name: "تمرين نفخ الخدين",
                description: "تمرين لتحسين مرونة الوجه وشد الجلد. يساعد في تحسين تدفق الدم للوجه.",
                gif: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHN4NndyMHk4bzEyY2J1cjYxam4xNGkycW5pand5bjljbzhuNzdyMiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/f5u4lf1SBqubtB88kz/giphy.gif",
                instructions: [
                    "خذ نفساً عميقاً واحبسه",
                    "انفخ خديك بالهواء",
                    "حرك الهواء بين الخدين",
                    "اثبت لمدة 10 ثوان",
                    "أخرج الهواء ببطء",
                    "كرر 8-10 مرات",
                    "يمكن أداء التمرين جالساً أو واقفاً"
                ],
                benefits: [
                    "تحسين مرونة الوجه",
                    "شد جلد الوجه",
                    "تحسين تدفق الدم",
                    "تنشيط عضلات الوجه"
                ]
            },
            {
                name: "تمرين الابتسامة الواسعة",
                description: "تمرين لشد عضلات الوجه وتحسين مظهر الجلد. يعمل على تنشيط عضلات الوجه.",
                gif: "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3dXdsc2J3MnNuaGtyaXQyZ2xyMXlrZXl4dG9tNGRkZHcwMTBnZGtzaSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/DXblkHYQGTa17QDjgm/giphy.gif",
                instructions: [
                    "افتح فمك بشكل عرضي كما لو تبتسم",
                    "اثبت على هذه الوضعية لمدة 10 ثوان",
                    "اشعر بشد في خديك وجوانب وجهك",
                    "أعد وجهك إلى الوضع الطبيعي",
                    "كرر 12-15 مرة",
                    "يمكنك وضع أصابعك على الخدين للتحكم",
                    "أداء التمرين ببطء وتركيز"
                ],
                benefits: [
                    "شد عضلات الوجه",
                    "تحسين مرونة الجلد",
                    "تنشيط عضلات الوجه",
                    "تحسين مظهر الوجه"
                ]
            }
        ],
        relax: [
            {
                name: "تمرين تدليك الفك والرقبة",
                description: "تمرين استرخاء مهم لتخفيف التوتر وتحسين الدورة الدموية في منطقة الفك والرقبة.",
                gif: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHN4NndyMHk4bzEyY2J1cjYxam4xNGkycW5pand5bjljbzhuNzdyMiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/f5u4lf1SBqubtB88kz/giphy.gif",
                instructions: [
                    "ضع أصابعك على مفاصل الفك",
                    "قوم بتدليك دائري خفيف",
                    "تحرك ببطء ناحية الرقبة",
                    "استمر في التدليك لمدة دقيقتين",
                    "ركز على المناطق المتوترة",
                    "تنفس بعمق خلال التدليك",
                    "كرر 2-3 مرات يومياً"
                ],
                benefits: [
                    "تخفيف توتر الفك",
                    "تحسين الدورة الدموية",
                    "استرخاء عضلات الوجه",
                    "تخفيف آلام الرقبة"
                ]
            },
            {
                name: "تمرين الاسترخاء العميق",
                description: "تمرين لاسترخاء جميع عضلات الوجه والرقبة بعد التمرين. يساعد في تحسين النتائج.",
                gif: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHN4NndyMHk4bzEyY2J1cjYxam4xNGkycW5pand5bjljbzhuNzdyMiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/eapuJ6TGZtxKae215G/giphy.gif",
                instructions: [
                    "اجلس أو استلق في وضع مريح",
                    "أغلق عينيك وتنفس بعمق",
                    "شد جميع عضلات وجهك لمدة 5 ثوان",
                    "أطلقها ببطء واشعر بالاسترخاء",
                    "كرر 5-7 مرات",
                    "ركز على التنفس العميق",
                    "استمر لمدة 3-5 دقائق"
                ],
                benefits: [
                    "استرخاء كامل للوجه",
                    "تحسين نتائج التمارين",
                    "تخفيف التوتر والقلق",
                    "تحسين جودة النوم"
                ]
            }
        ]
    };
    
    // ==== نظام الكاميرا ====
    async function startCamera() {
        try {
            cameraStream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'user',
                    width: { ideal: 640 },
                    height: { ideal: 480 }
                } 
            });
            const video = document.getElementById('videoElement');
            video.srcObject = cameraStream;
            showNotification('كاميرا الوجه والرقبة جاهزة ✓', 'success');
            
            // تفعيل زر بدء التمرين
            document.getElementById('startBtn').disabled = false;
            
            // تحديث رسالة الكوتش
            updateCoachMessage('كاميرا الوجه جاهزة! يمكنك الآن بدء التمارين. تأكد من أن وجهك ورقبتك واضحين في الإطار.');
            
            // بدء محاكاة تحليل الوجه
            startFaceAnalysis();
            
        } catch (error) {
            showNotification('تعذر الوصول للكاميرا: ' + error.message, 'error');
            updateCoachMessage('عذراً، هناك مشكلة في الكاميرا. تأكد من السماح للوصول للكاميرا.');
        }
    }
    
    function stopCamera() {
        if (cameraStream) {
            cameraStream.getTracks().forEach(track => track.stop());
            document.getElementById('videoElement').srcObject = null;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;
            exerciseActive = false;
            stopExerciseTimer();
            showNotification('تم إيقاف الكاميرا', 'info');
            updateCoachMessage('تم إيقاف الكاميرا. يمكنك إعادة تشغيلها عندما تكون جاهزاً.');
        }
    }
    
    // ==== أدوات الوجه ====
    function toggleJawLine() {
        const jawLine = document.getElementById('jawLine');
        jawLine.style.display = jawLine.style.display === 'none' ? 'block' : 'none';
    }
    
    function toggleNeckLine() {
        const neckLine = document.getElementById('neckLine');
        neckLine.style.display = neckLine.style.display === 'none' ? 'block' : 'none';
    }
    
    function toggleSymmetry() {
        // محاكاة خط التناسق
        const faceGuide = document.querySelector('.face-guide');
        if (faceGuide.style.borderColor === 'yellow') {
            faceGuide.style.borderColor = '#00be9f';
        } else {
            faceGuide.style.borderColor = 'yellow';
            updateCoachMessage('خط التناسق مفعل. حاول أن تحافظ على تناسق وجهك مع الخط الأصفر.');
        }
    }
    
    // ==== نظام التمارين ====
    function selectCategory(category) {
        currentCategory = category;
        currentExerciseIndex = 0;
        
        // تحديث الأزرار النشطة
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // تحميل أول تمرين في الفئة
        loadCurrentExercise();
        
        // تحديث رسالة الكوتش بناءً على الفئة
        const categoryNames = {
            'jaw': 'الفك',
            'neck': 'الرقبة',
            'face': 'الوجه',
            'relax': 'الاسترخاء'
        };
        
        updateCoachMessage(`تم اختيار فئة ${categoryNames[category]}. رائع! هذه التمارين ستحسن من مظهر الجولاين بشكل ملحوظ.`);
    }
    
    function loadCurrentExercise() {
        const exercises = exercisesDB[currentCategory];
        const exercise = exercises[currentExerciseIndex];
        
        // تحديث المعلومات
        document.getElementById('currentExerciseName').textContent = exercise.name;
        document.getElementById('currentExerciseDesc').textContent = exercise.description;
        document.getElementById('exerciseGif').src = exercise.gif;
        
        // تحديث التعليمات
        const instructionsList = document.getElementById('instructions');
        instructionsList.innerHTML = '';
        exercise.instructions.forEach(instruction => {
            const li = document.createElement('li');
            li.textContent = instruction;
            instructionsList.appendChild(li);
        });
    }
    
    function nextExercise() {
        const exercises = exercisesDB[currentCategory];
        currentExerciseIndex = (currentExerciseIndex + 1) % exercises.length;
        loadCurrentExercise();
        updateCoachMessage('تمرين جديد! ركز على تنفيذ التعليمات بدقة.');
    }
    
    function previousExercise() {
        const exercises = exercisesDB[currentCategory];
        currentExerciseIndex = (currentExerciseIndex - 1 + exercises.length) % exercises.length;
        loadCurrentExercise();
        updateCoachMessage('إعادة التمرين السابق. الممارسة تصنع الإتقان!');
    }
    
    function repeatExercise() {
        const gif = document.getElementById('exerciseGif');
        gif.src = gif.src; // إعادة تحميل الـ GIF
        updateCoachMessage('أعدت مشاهدة التمرين. تأكد من فهم كل خطوة قبل البدء.');
    }
    
    // ==== بدء وإيقاف التمرين ====
    function startExercise() {
        if (!cameraStream) {
            showNotification('الرجاء تشغيل الكاميرا أولاً', 'warning');
            return;
        }
        
        exerciseActive = true;
        exerciseSeconds = 0;
        jawAccuracy = 0;
        neckAccuracy = 0;
        symmetryScore = 0;
        
        // تفعيل/تعطيل الأزرار
        document.getElementById('startBtn').disabled = true;
        document.getElementById('stopBtn').disabled = false;
        
        // بدء المؤقت
        startExerciseTimer();
        
        // بدء محاكاة التحليل
        startAccuracySimulation();
        
        // تحديث رسالة الكوتش
        const exerciseName = document.getElementById('currentExerciseName').textContent;
        updateCoachMessage(`بدأ التمرين: ${exerciseName}! حافظ على الوضعية الصحيحة وركز على التنفس. أنا هنا لمساعدتك!`);
        
        showNotification('بدأ التمرين! حافظ على وجهك في مركز الإطار ✓', 'success');
    }
    
    function stopExercise() {
        exerciseActive = false;
        
        // تفعيل/تعطيل الأزرار
        document.getElementById('startBtn').disabled = false;
        document.getElementById('stopBtn').disabled = true;
        
        // إيقاف المؤقت والمحاكاة
        stopExerciseTimer();
        stopAccuracySimulation();
        
        // حساب النتيجة النهائية
        calculateFinalScore();
        
        // عرض النتائج
        showResults();
        
        updateCoachMessage('أحسنت! لقد أنهيت التمرين بنجاح. دعني أريك نتائجك...');
        showNotification('تم إنهاء التمرين ✓ جاري حساب النتائج...', 'info');
    }
    
    // ==== نظام المؤقت ====
    function startExerciseTimer() {
        clearInterval(exerciseTimer);
        exerciseTimer = setInterval(() => {
            exerciseSeconds++;
            updateTimerDisplay();
            
            // محاكاة تحسين الدقة مع الوقت
            if (exerciseActive) {
                if (jawAccuracy < 95) jawAccuracy += Math.random() * 1.5;
                if (neckAccuracy < 95) neckAccuracy += Math.random() * 1.2;
                if (symmetryScore < 95) symmetryScore += Math.random() * 1;
                
                updateProgressCircles();
            }
        }, 1000);
    }
    
    function stopExerciseTimer() {
        clearInterval(exerciseTimer);
    }
    
    function updateTimerDisplay() {
        const hours = Math.floor(exerciseSeconds / 3600);
        const minutes = Math.floor((exerciseSeconds % 3600) / 60);
        const seconds = exerciseSeconds % 60;
        
        document.getElementById('timer').textContent = 
            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    // ==== محاكاة التحليل ====
    let analysisInterval = null;
    
    function startAccuracySimulation() {
        clearInterval(analysisInterval);
        
        analysisInterval = setInterval(() => {
            if (exerciseActive) {
                // محاكاة تقييم الكوتش بناءً على الأداء
                if (Math.random() > 0.7) {
                    giveRandomFeedback();
                }
                
                // تحديث الإحصائيات
                updateProgressCircles();
            }
        }, 2000);
    }
    
    function stopAccuracySimulation() {
        clearInterval(analysisInterval);
    }
    
    function updateProgressCircles() {
        // تحديث دوائر التقدم
        const jawProgress = 314 * (1 - jawAccuracy / 100);
        const neckProgress = 314 * (1 - neckAccuracy / 100);
        
        document.getElementById('jawProgress').style.strokeDashoffset = jawProgress;
        document.getElementById('neckProgress').style.strokeDashoffset = neckProgress;
        
        document.getElementById('jawScore').textContent = Math.round(jawAccuracy) + '%';
        document.getElementById('neckScore').textContent = Math.round(neckAccuracy) + '%';
    }
    
    // ==== نظام الكوتش الذكي ====
    function updateCoachMessage(message) {
        document.getElementById('messageText').textContent = message;
        document.getElementById('coachMessage').style.animation = 'none';
        setTimeout(() => {
            document.getElementById('coachMessage').style.animation = 'pulseMessage 2s infinite';
        }, 10);
    }
    
    function askCoach(topic) {
        const responses = {
            'نصائح': [
                "💡 نصائح سريعة: حافظ على استقامة ظهرك خلال التمارين، تنفس بعمق، لا تبالغ في الشد، كرر التمارين يومياً.",
                "🎯 تذكر: الانتظام أهم من الكثرة. 15 دقيقة يومياً أفضل من ساعتين أسبوعياً.",
                "🌟 نصيحة: استخدم مرآة أثناء التمرين لمراقبة وضعيتك وتحسين الأداء."
            ],
            'وضعية': [
                "📏 وضعيتك جيدة! حافظ على استقامة الرأس مع الظهر.",
                "⚖️ لاحظت بعض عدم التناسق في حركة الفك، حاول التركيز على الجانب الأضعف.",
                "👍 الوضعية ممتازة! استمر في الحفاظ على هذه الاستقامة."
            ],
            'تغذية': [
                "🥗 نصائح غذائية: اشرب 2 لتر ماء يومياً، تناول الأطعمة الغنية بالكولاجين، تجنب الأملاح الزائدة.",
                "🍎 للأفضل: تناول التفاح والجزر لمضغ صحي، الأسماك للكولاجين، الخضار الورقية لمضادات الأكسدة.",
                "💧 الماء: شرب الماء بانتظام يحسن مرونة الجلد ويساعد في شد الجولاين."
            ]
        };
        
        const randomResponse = responses[topic][Math.floor(Math.random() * responses[topic].length)];
        updateCoachMessage(randomResponse);
    }
    
    function giveRandomFeedback() {
        const feedbacks = [
            { type: 'good', message: 'ممتاز! وضعية الفك صحيحة تماماً ✓' },
            { type: 'good', message: 'الرقبة مستقيمة بشكل رائع، استمر هكذا! 👏' },
            { type: 'warning', message: 'انتبه! لا ترفع كتفيك أكثر من اللازم ⚠️' },
            { type: 'good', message: 'التنفس منتظم وممتاز، أحسنت! 🌬️' },
            { type: 'warning', message: 'حاول إبطاء الحركة قليلاً، التركيز على الجودة ⏳' },
            { type: 'good', message: 'الشد ممتاز! تشعر العضلات تعمل 💪' }
        ];
        
        const feedback = feedbacks[Math.floor(Math.random() * feedbacks.length)];
        
        // إضافة تعليق سريع
        const message = `[${exerciseSeconds} ثانية] ${feedback.message}`;
        
        // 50% فرصة لإظهار الإشعار
        if (Math.random() > 0.5) {
            showNotification(feedback.message, feedback.type === 'good' ? 'success' : 'warning');
        }
    }
    
    // ==== نظام النتائج ====
    function calculateFinalScore() {
        const timeScore = Math.min(exerciseSeconds * 0.5, 25); // 25% كحد أقصى للوقت
        const jawScore = jawAccuracy * 0.4; // 40% لدقة الفك
        const neckScore = neckAccuracy * 0.3; // 30% لدقة الرقبة
        const symmetryBonus = symmetryScore * 0.05; // 5% للتناسق
        
        totalScore = Math.round(timeScore + jawScore + neckScore + symmetryBonus);
        
        // تحديث العرض
        document.getElementById('finalScore').textContent = totalScore;
        
        // تحديد مستوى الإنجاز
        let achievement = '';
        if (totalScore >= 90) {
            achievement = 'ممتاز 🏆';
        } else if (totalScore >= 70) {
            achievement = 'جيد جداً 👍';
        } else if (totalScore >= 50) {
            achievement = 'مقبول 👌';
        } else {
            achievement = 'يحتاج تحسين 📈';
        }
        
        // إنشاء التقييم النهائي
        generateFinalFeedback(achievement);
    }
    
    function generateFinalFeedback(achievement) {
        const feedbackGrid = document.getElementById('feedbackGrid');
        feedbackGrid.innerHTML = '';
        
        const feedbacks = [
            {
                title: 'تقييم الفك',
                content: jawAccuracy >= 80 ? 
                    'أداء رائع! حافظت على وضعية الفك الصحيحة' : 
                    'يمكن تحسين وضعية الفك، ركز أكثر في الجلسات القادمة',
                type: jawAccuracy >= 80 ? 'good' : 'warning'
            },
            {
                title: 'تقييم الرقبة',
                content: neckAccuracy >= 75 ? 
                    'الرقبة مستقيمة بشكل جيد، استمر في الحفاظ على الوضعية' : 
                    'انتبه لوضعية الرقبة، حاول إبقاء الكتفين منخفضين',
                type: neckAccuracy >= 75 ? 'good' : 'warning'
            },
            {
                title: 'الوقت والانتظام',
                content: `قضيت ${exerciseSeconds} ثانية في التمرين. ${exerciseSeconds >= 120 ? 'وقت ممتاز!' : 'حاول زيادة وقت التمرين'}`,
                type: exerciseSeconds >= 120 ? 'good' : 'warning'
            },
            {
                title: 'مستوى الإنجاز',
                content: `${achievement} - النتيجة: ${totalScore}/100`,
                type: totalScore >= 70 ? 'good' : totalScore >= 50 ? 'warning' : 'bad'
            }
        ];
        
        feedbacks.forEach(feedback => {
            const card = document.createElement('div');
            card.className = `feedback-card ${feedback.type}`;
            card.innerHTML = `
                <h4><i class="fas fa-${feedback.type === 'good' ? 'check-circle' : feedback.type === 'warning' ? 'exclamation-triangle' : 'exclamation-circle'}"></i>
                ${feedback.title}</h4>
                <p>${feedback.content}</p>
            `;
            feedbackGrid.appendChild(card);
        });
    }
    
    function showResults() {
        document.getElementById('resultsSection').style.display = 'block';
        
        // تمرير سلس إلى القسم
        document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
    }
    
    // ==== رحلة التقدم ====
    function saveProgress() {
        const today = new Date().toLocaleDateString('ar-SA');
        const progressData = {
            date: today,
            score: totalScore,
            jawAccuracy: Math.round(jawAccuracy),
            neckAccuracy: Math.round(neckAccuracy),
            time: exerciseSeconds,
            exercise: document.getElementById('currentExerciseName').textContent
        };
        
        // حفظ في localStorage
        localStorage.setItem(`goolainProgress_${today}`, JSON.stringify(progressData));
        
        // تحديث المعالم
        updateMilestones();
        
        showNotification('تم حفظ التقدم اليومي بنجاح ✓', 'success');
        updateCoachMessage('تم حفظ تقدمك! رائع، الاستمرارية هي مفتاح النجاح. أراك في الجلسة القادمة!');
    }
    
    function updateMilestones() {
        // محاكاة تحديث المعالم بناءً على عدد الجلسات
        const savedSessions = Object.keys(localStorage).filter(key => key.startsWith('goolainProgress_')).length;
        
        const milestones = document.querySelectorAll('.milestone');
        milestones.forEach((milestone, index) => {
            if (savedSessions >= (index + 1) * 7) { // كل 7 جلسات = أسبوع
                milestone.classList.add('reached');
                milestone.classList.remove('active');
            } else if (savedSessions >= index * 7) {
                milestone.classList.add('active');
                milestone.classList.remove('reached');
            } else {
                milestone.classList.remove('active', 'reached');
            }
        });
    }
    
    function showProgressReport() {
        const savedSessions = Object.keys(localStorage).filter(key => key.startsWith('goolainProgress_'));
        
        if (savedSessions.length === 0) {
            showNotification('لا توجد جلسات سابقة', 'info');
            return;
        }
        
        let report = `📊 تقرير تقدم شد الجولاين\n\n`;
        report += `عدد الجلسات: ${savedSessions.length}\n\n`;
        
        savedSessions.forEach(key => {
            const session = JSON.parse(localStorage.getItem(key));
            report += `📅 ${session.date}: ${session.score}/100 (${session.exercise})\n`;
        });
        
        alert(report);
    }
    
    // ==== أدوات إضافية ====
    function shareResults() {
        const exerciseName = document.getElementById('currentExerciseName').textContent;
        const shareText = `🏋️ نتائج تمرين شد الجولاين:
التمرين: ${exerciseName}
النتيجة: ${totalScore}/100 ⭐
وقت التمرين: ${Math.floor(exerciseSeconds/60)}:${exerciseSeconds%60} دقيقة
دقة الفك: ${Math.round(jawAccuracy)}% ✓
دقة الرقبة: ${Math.round(neckAccuracy)}% ✓

#شد_الجولاين #تمارين_الوجه #صحة_وجمال`;
        
        if (navigator.share) {
            navigator.share({
                title: 'نتائج تمرين شد الجولاين',
                text: shareText
            });
        } else {
            navigator.clipboard.writeText(shareText);
            showNotification('تم نسخ النتائج للحافظة ✓', 'success');
        }
    }
    
    function printCertificate() {
        const certificateHTML = `
            <div style="text-align: center; padding: 40px; background: linear-gradient(45deg, #00be9f, #009688); color: white; border-radius: 20px;">
                <h1 style="font-size: 2.5rem;">🏆 شهادة إنجاز 🏆</h1>
                <h2 style="margin: 20px 0;">نظام شد الجولاين المتقدم</h2>
                <div style="font-size: 1.5rem; margin: 30px 0;">
                    ممنوحة للمتدرب المتميز<br>
                    على إكمال جلسة تدريبية متكاملة<br>
                    بنتيجة: ${totalScore}/100 نقطة
                </div>
                <div style="margin: 30px 0;">
                    تاريخ: ${new Date().toLocaleDateString('ar-SA')}
                </div>
                <div style="border-top: 2px solid white; padding-top: 20px;">
                    واصل التقدم، فالاستمرارية سر النجاح
                </div>
            </div>
        `;
        
        const win = window.open('', '_blank');
        win.document.write(certificateHTML);
        win.document.close();
        win.print();
    }
    
    function scheduleNextSession() {
        const nextDay = new Date();
        nextDay.setDate(nextDay.getDate() + 1);
        const nextDate = nextDay.toLocaleDateString('ar-SA');
        
        if (confirm(`هل تريد جدولة الجلسة القادمة ليوم ${nextDate} الساعة 7:00 مساءً؟`)) {
            showNotification(`تم جدولة الجلسة القادمة ليوم ${nextDate} ✓`, 'success');
            updateCoachMessage(`رائع! الجلسة القادمة مجدولة ليوم ${nextDate}. لا تنسى شرب الماء اليوم!`);
        }
    }
    
    // ==== محاكاة تحليل الوجه ====
    function startFaceAnalysis() {
        setInterval(() => {
            if (cameraStream && exerciseActive) {
                // محاكاة اكتشاف نقاط الوجه
                simulateFacePoints();
                
                // تحديث التقييمات
                jawAccuracy = Math.min(100, jawAccuracy + Math.random() * 0.5);
                neckAccuracy = Math.min(100, neckAccuracy + Math.random() * 0.3);
                symmetryScore = Math.min(100, symmetryScore + Math.random() * 0.2);
                
                updateProgressCircles();
            }
        }, 1000);
    }
    
    function simulateFacePoints() {
        const indicators = document.querySelector('.face-overlay');
        // يمكن إضافة نقاط محاكاة للوجه هنا
    }
    
    // ==== نظام الإشعارات ====
    function showNotification(message, type) {
        const colors = {
            success: '#00be9f',
            error: '#f44336',
            warning: '#ff9800',
            info: '#2196F3'
        };
        
        const icons = {
            success: 'fa-check-circle',
            error: 'fa-times-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        };
        
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.style.background = colors[type] || '#333';
        notification.innerHTML = `
            <i class="fas ${icons[type]}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideIn 0.5s ease reverse';
            setTimeout(() => notification.remove(), 500);
        }, 4000);
    }
    
    // ==== التهيئة ====
    document.addEventListener('DOMContentLoaded', () => {
        // تحميل بيانات المستخدم
        const loggedUser = JSON.parse(localStorage.getItem('loggedInUser'));
        const userInfo = document.getElementById('userInfo');
        const loginBtn = document.getElementById('loginBtn');
        const displayName = document.getElementById('displayName');
        const userAvatar = document.getElementById('userAvatar');
        
        if (loggedUser) {
            displayName.textContent = loggedUser.username || "متدرب الجولاين";
            userAvatar.src = loggedUser.avatar || "https://api.dicebear.com/7.x/avataaars/svg?seed=" + loggedUser.username;
            userInfo.style.display = "flex";
            loginBtn.style.display = "none";
        } else {
            userInfo.style.display = "none";
            loginBtn.style.display = "inline-flex";
        }
        
        // تحميل أول تمرين
        loadCurrentExercise();
        
        // تحديث المعالم
        updateMilestones();
    });
    
    function logout() {
        localStorage.removeItem('loggedInUser');
        window.location.reload();
    }
    
    function redirectToLogin() {
        window.location.href = "login.html";
    }
    
    // إيقاف الكاميرا عند مغادرة الصفحة
    window.addEventListener('beforeunload', () => {
        if (cameraStream) {
            cameraStream.getTracks().forEach(track => track.stop());
        }
    });
</script>
</body>
</html>