<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ูุฏุฑุจ ุฑูุงุถู - ููุงุทุนุฉ ุงูุฑูุงู ููุญูุงุฉ ุงููุงูุนูุฉ</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        /* ุงูุญูุงุธ ุนูู ููุณ ุฃููุงุท ุงูููุฏุฑ ุจุงูุถุจุท */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #00be9f;
        }
        .user-details span {
            display: block;
            font-weight: bold;
            color: #fff;
        }
        .logout-btn {
            background: transparent;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 1.1rem;
        }
        .login-btn {
            background-color: #00be9f;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }
        .login-btn i {
            font-size: 1.2rem;
        }
        
        /* ูุธุงู ุงููุฏุฑุจ ุงูุฑูุงุถู ูุน ูุดู ุญุฑูุฉ ุญูููู */
        .trainer-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 15px;
        }
        
        .trainer-header {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid #00be9f;
        }
        
        .trainer-title {
            color: #00be9f;
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .trainer-subtitle {
            color: #ccc;
            font-size: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .camera-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .camera-section {
                grid-template-columns: 1fr;
            }
        }
        
        .camera-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #00be9f;
        }
        
        .camera-title {
            color: #00be9f;
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .camera-preview {
            width: 100%;
            height: 400px;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            margin-bottom: 15px;
        }
        
        #cameraFeed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
            transform: scaleX(-1);
        }
        
        #motionCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }
        
        .camera-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            color: #ccc;
            z-index: 1;
        }
        
        .camera-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #00be9f;
        }
        
        .camera-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .trainer-btn {
            background: linear-gradient(45deg, #00be9f, #009688);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .trainer-btn:hover {
            background: linear-gradient(45deg, #00d4b1, #00be9f);
            transform: translateY(-2px);
        }
        
        .trainer-btn.stop {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
        }
        
        .trainer-btn.secondary {
            background: linear-gradient(45deg, #666, #444);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(0, 190, 159, 0.3);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00be9f;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .feedback-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #00be9f;
        }
        
        .feedback-title {
            color: #00be9f;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #feedbackMessage {
            color: white;
            line-height: 1.5;
            min-height: 60px;
        }
        
        .motion-analysis {
            margin-top: 20px;
        }
        
        .motion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .motion-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        
        .motion-value {
            color: #00ffcc;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .motion-label {
            color: #ccc;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .exercises-section {
            margin-top: 30px;
        }
        
        .section-title {
            color: #00be9f;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .exercises-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .exercise-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .exercise-card:hover {
            border-color: #00be9f;
            transform: translateY(-5px);
        }
        
        .exercise-card.active {
            border-color: #00be9f;
            background: rgba(0, 190, 159, 0.2);
        }
        
        .exercise-icon {
            font-size: 2rem;
            color: #00be9f;
            margin-bottom: 10px;
        }
        
        .exercise-title {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .exercise-desc {
            color: #ccc;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        /* ุฃููููุดู ููุชูุฑุงุฑุงุช */
        @keyframes repPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .rep-animation {
            animation: repPulse 0.5s ease;
        }
        
        /* ูุคุดุฑ ุงูุญุฑูุฉ */
        .motion-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #333;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .motion-indicator.active {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        
        /* ุงูุชุณุฌูู ุงูุฏุฎูู */
        .auth-status {
            position: absolute;
            left: 20px;
            top: 15px;
        }
        
        /* ููุชุฑ */
        footer {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            margin-top: 30px;
            font-size: 0.8rem;
            color: #ccc;
        }
        
        footer a {
            color: #00be9f;
            text-decoration: none;
        }
        
        /* ุชูุจููุงุช */
        .alert {
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .alert-success {
            background: rgba(0, 190, 159, 0.2);
            border: 1px solid #00be9f;
            color: #00be9f;
        }
        
        .alert-warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            color: #ffc107;
        }
    </style>
</head>
<body>
<header class="glass">
    <div class="auth-status">
        <!-- ุฒุฑ ุงูููุณููู -->
        <button onclick="openMusicPlayer()" class="music-btn" title="ูุดุบู ุงูููุณููู">
            <i class="fas fa-music"></i>
        </button>
        
        <!-- ุญุงูุฉ ุงููุณุชุฎุฏู -->
        <span id="userInfo" style="display: none;">
            <div class="user-profile">
                <img id="userAvatar" src="default-avatar.png" alt="ุตูุฑุฉ ุงููุณุชุฎุฏู" class="user-avatar" />
                <div class="user-details">
                    <span id="displayName"></span>
                </div>
                <button onclick="logout()" class="logout-btn" title="ุชุณุฌูู ุฎุฑูุฌ">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </span>
        
        <!-- ุฒุฑ ุชุณุฌูู ุงูุฏุฎูู -->
        <button onclick="redirectToLogin()" id="loginBtn" class="login-btn">
            <i class="fas fa-sign-in-alt"></i> ุชุณุฌูู ุฏุฎูู
        </button>
    </div>

    <nav>
        <!-- ูุงุฆูุฉ ุงูุชููู -->
        <ul>
            <li><a href='index.html'><i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ</a></li>
            <li><a href='features.html'><i class="fas fa-star"></i> ูุฏุฑุจ ุฑูุงุถู</a></li>
            <li><a href='rules.html'><i class="fas fa-gavel"></i> ุดุฏ ุงูุฌููุงูู</a></li>
            <li><a class='active' href='download.html'><i class="fas fa-download"></i> qr code </a></li>
            <li><a href='apply.html'><i class="fas fa-user-shield"></i> ุทุจูุจ ุงููุชุฑููู </a></li>
            <li><a href='faq.html'><i class="fas fa-question-circle"></i> ุฏุฑุฏุดุฉ ุงูุฎุจุฑุงุก</a></li>
            <li><a href='shop.html'><i class="fas fa-store"></i> ุงูุนุจูุฑู ุงูุฐูู </a></li>
        </ul>
    </nav>
</header>

<main class="trainer-container">
    <!-- ูุธุงู ุงููุฏุฑุจ ุงูุฑูุงุถู ุงูุฐูู ูุน ูุดู ุญุฑูุฉ ุญูููู -->
    <div class="trainer-header">
        <h1 class="trainer-title">
            <i class="fas fa-dumbbell"></i> ูุฏุฑุจ ุฑูุงุถู ุจูุดู ุญุฑูุฉ ุญูููู
        </h1>
        <p class="trainer-subtitle">
            ูุธุงู ุฐูู ููุดู ุญุฑูุชู ุงููุนููุฉ ููุญุณุจ ุชูุฑุงุฑุงุชู ุจุฏูุฉ ุจุงุณุชุฎุฏุงู ูุงููุฑุง ุงูููุจ
        </p>
    </div>

    <!-- ููุทูุฉ ุงููุงููุฑุง ูุงูุชุญููู -->
    <div class="camera-section">
        <!-- ุงููุงููุฑุง -->
        <div class="camera-box">
            <h3 class="camera-title">
                <i class="fas fa-video"></i> ูุงููุฑุง ูุดู ุงูุญุฑูุฉ
            </h3>
            <div class="camera-preview">
                <video id="cameraFeed" autoplay playsinline muted></video>
                <canvas id="motionCanvas"></canvas>
                <div class="camera-placeholder" id="cameraPlaceholder">
                    <i class="fas fa-camera"></i>
                    <p>ุงุถุบุท ุนูู "ุชุดุบูู ุงููุงููุฑุง" ูุจุฏุก ูุดู ุงูุญุฑูุฉ</p>
                </div>
            </div>
            <div class="camera-controls">
                <button class="trainer-btn" id="startCamera" onclick="startCamera()">
                    <i class="fas fa-play"></i> ุชุดุบูู ุงููุงููุฑุง
                </button>
                <button class="trainer-btn stop" id="stopCamera" onclick="stopCamera()" style="display:none;">
                    <i class="fas fa-stop"></i> ุฅููุงู ุงููุงููุฑุง
                </button>
                <button class="trainer-btn secondary" onclick="resetCounters()" id="resetBtn">
                    <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุงูุชุนููู
                </button>
            </div>
            
            <div class="motion-analysis" id="motionAnalysis" style="display:none;">
                <h4 class="feedback-title">
                    <i class="fas fa-running"></i> ุชุญููู ุงูุญุฑูุฉ
                </h4>
                <div class="motion-grid">
                    <div class="motion-item">
                        <div class="motion-value" id="motionLevel">0%</div>
                        <div class="motion-label">ุดุฏุฉ ุงูุญุฑูุฉ</div>
                    </div>
                    <div class="motion-item">
                        <div class="motion-value" id="motionSpeed">0</div>
                        <div class="motion-label">ุณุฑุนุฉ (px/frame)</div>
                    </div>
                    <div class="motion-item">
                        <div class="motion-value" id="motionArea">0%</div>
                        <div class="motion-label">ููุทูุฉ ุงูุญุฑูุฉ</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                    <div style="color: #ccc; margin-bottom: 5px;">
                        <span class="motion-indicator" id="motionIndicator"></span>
                        ุญุงูุฉ ุงููุดู: <span id="motionStatus" style="color: #00be9f;">ุฌุงุฑู ุงูุชุญููู...</span>
                    </div>
                    <div id="motionDetails" style="font-size: 0.8rem; color: #aaa;">
                        ููุชุดู ุงููุธุงู ุฃู ุญุฑูุฉ ูู ูุฌุงู ุงูุฑุคูุฉ
                    </div>
                </div>
            </div>
        </div>

        <!-- ุงูุชุญููู ูุงูุฅุญุตุงุฆูุงุช -->
        <div class="camera-box">
            <h3 class="camera-title">
                <i class="fas fa-chart-bar"></i> ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก
            </h3>
            
            <div class="alert alert-success" id="exerciseAlert" style="display:none;">
                <i class="fas fa-bell"></i> <span id="alertMessage"></span>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="repsCount">0</div>
                    <div class="stat-label">ุนุฏุฏ ุงูุชูุฑุงุฑุงุช</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="accuracyScore">0%</div>
                    <div class="stat-label">ุฏูุฉ ุงูุญุฑูุฉ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sessionTime">00:00</div>
                    <div class="stat-label">ูุฏุฉ ุงูุฌูุณุฉ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="caloriesBurned">0</div>
                    <div class="stat-label">ุณุนุฑุงุช ุญุฑุงุฑูุฉ</div>
                </div>
            </div>

            <div class="feedback-box">
                <h4 class="feedback-title">
                    <i class="fas fa-comment-alt"></i> ุชูุฌููุงุช ุงููุฏุฑุจ
                </h4>
                <div id="feedbackMessage">
                    ๐ ูู ุจุชุดุบูู ุงููุงููุฑุง ูุงุจุฏุฃ ุงูุญุฑูุฉ ุฃูุงููุง
                </div>
                
                <div style="margin-top: 15px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div style="width: 20px; height: 20px; border-radius: 50%; background: #00be9f;"></div>
                        <span style="color: #ccc; font-size: 0.9rem;">ูุณุชูู ุงููุดุงุท: </span>
                        <div id="activityBar" style="flex: 1; height: 10px; background: #333; border-radius: 5px; overflow: hidden;">
                            <div id="activityFill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #00be9f, #00ffcc); transition: width 0.5s;"></div>
                        </div>
                    </div>
                    
                    <div id="repProgress" style="display:none;">
                        <div style="color: #ccc; margin-bottom: 5px;">ุงูุชูุฏู ูุญู ุงููุฏู: <span id="progressText">0%</span></div>
                        <div style="height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
                            <div id="progressFill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #ff416c, #ff4b2b); transition: width 0.5s;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ุชุนูููุงุช ุงูุงุณุชุฎุฏุงู -->
    <div class="camera-box" style="margin-top: 20px;">
        <h3 class="camera-title">
            <i class="fas fa-graduation-cap"></i> ููููุฉ ุนูู ุงููุธุงู
        </h3>
        <div style="color: #ccc; line-height: 1.6;">
            <p>โ <strong>ููู ูุนูู:</strong></p>
            <ul style="margin-right: 20px;">
                <li>1. ุงููุงููุฑุง ุชูุดู ุฃู ุญุฑูุฉ ูู ูุฌุงู ุงูุฑุคูุฉ</li>
                <li>2. ูู ุญุฑูุฉ ูุจูุฑุฉ ุชุญุณุจ ูุชูุฑุงุฑ ูุงุญุฏ</li>
                <li>3. ุงููุธุงู ูููุฒ ุจูู ุงูุญุฑูุงุช ุงูุตุบูุฑุฉ ูุงููุจูุฑุฉ</li>
                <li>4. ูุชู ุญุณุงุจ ุงูุฏูุฉ ุจูุงุกู ุนูู ุงูุชุธุงู ุงูุญุฑูุฉ</li>
                <li>5. ุงูุณุนุฑุงุช ุงูุญุฑุงุฑูุฉ ุชุญุณุจ ุชููุงุฆูุงู</li>
            </ul>
            <p style="margin-top: 10px;">๐ฏ <strong>ูุตุงุฆุญ ูุฃูุถู ุงููุชุงุฆุฌ:</strong></p>
            <ul style="margin-right: 20px;">
                <li>โข ูู ุนูู ุจุนุฏ 2-3 ูุชุฑ ูู ุงููุงููุฑุง</li>
                <li>โข ุชุฃูุฏ ูู ุฅุถุงุกุฉ ุฌูุฏุฉ ูู ุงูุบุฑูุฉ</li>
                <li>โข ุญุงูุธ ุนูู ุฎูููุฉ ุซุงุจุชุฉ ูุฏุฑ ุงูุฅููุงู</li>
                <li>โข ูู ุจุญุฑูุงุช ูุงุถุญุฉ ูููุชููุฉ</li>
            </ul>
        </div>
    </div>

    <!-- ุงูุชูุงุฑูู ุงูุชูุตูููุฉ -->
    <div class="exercises-section" id="exercisesSection">
        <h2 class="section-title">
            <i class="fas fa-dumbbell"></i> ููุชุจุฉ ุงูุชูุงุฑูู ุงูุชูุตูููุฉ
        </h2>
        
        <div class="exercises-grid">
            <!-- ุชูุฑูู 1: ุชูุฑูู ุงูุถุบุท -->
            <div class="exercise-card" onclick="selectExercise('pushups')">
                <div class="exercise-icon">
                    <i class="fas fa-user"></i>
                </div>
                <h3 class="exercise-title">ุชูุฑูู ุงูุถุบุท (Push-ups)</h3>
                <p class="exercise-desc">
                    <strong>ุงููุฌููุนุงุช ุงููุณุชูุฏูุฉ:</strong> ุงูุตุฏุฑุ ุงููุชูููุ ุงูุนุถูุฉ ุซูุงุซูุฉ ุงูุฑุคูุณ<br>
                    <strong>ุงููุณุชูู:</strong> ูุจุชุฏุฆ - ูุชูุฏู<br>
                    <strong>ุงูุชูุฑุงุฑุงุช ุงููุณุชูุฏูุฉ:</strong> 15-30
                </p>
                <div style="background: rgba(0,190,159,0.1); padding: 10px; border-radius: 6px; margin-top: 10px;">
                    <strong style="color: #00be9f;">ููููุฉ ุงูุฃุฏุงุก:</strong>
                    <ol style="margin-right: 15px; margin-top: 8px; color: #ccc; font-size: 0.85rem;">
                        <li>ุงุณุชููู ุนูู ุจุทูู ูุน ูุถุน ูุฏูู ุจูุณุชูู ุงูุตุฏุฑ</li>
                        <li>ุงุฏูุน ุฌุณูู ูุฃุนูู ุญุชู ุชูุฏ ุฐุฑุงุนูู ุจุงููุงูู</li>
                        <li>ุงุฎูุถ ุฌุณูู ุญุชู ููุชุฑุจ ุตุฏุฑู ูู ุงูุฃุฑุถ</li>
                        <li>ุญุงูุธ ุนูู ุงุณุชูุงูุฉ ุฌุณูู ุฎูุงู ุงูุชูุฑูู</li>
                    </ol>
                </div>
            </div>

            <!-- ุชูุฑูู 2: ุงููุฑูุตุงุก -->
            <div class="exercise-card" onclick="selectExercise('squats')">
                <div class="exercise-icon">
                    <i class="fas fa-walking"></i>
                </div>
                <h3 class="exercise-title">ุชูุฑูู ุงููุฑูุตุงุก (Squats)</h3>
                <p class="exercise-desc">
                    <strong>ุงููุฌููุนุงุช ุงููุณุชูุฏูุฉ:</strong> ุงููุฎุฐููุ ุงูุฃุฑุฏุงูุ ุนุถูุงุช ุงูุจุทู<br>
                    <strong>ุงููุณุชูู:</strong> ูุจุชุฏุฆ - ูุชูุฏู<br>
                    <strong>ุงูุชูุฑุงุฑุงุช ุงููุณุชูุฏูุฉ:</strong> 20-40
                </p>
                <div style="background: rgba(0,190,159,0.1); padding: 10px; border-radius: 6px; margin-top: 10px;">
                    <strong style="color: #00be9f;">ููููุฉ ุงูุฃุฏุงุก:</strong>
                    <ol style="margin-right: 15px; margin-top: 8px; color: #ccc; font-size: 0.85rem;">
                        <li>ูู ููุฏููู ูุชุจุงุนุฏุชูู ุจุนุฑุถ ุงููุชููู</li>
                        <li>ุงุฎูุถ ุฌุณูู ููุง ูู ุชุฌูุณ ุนูู ูุฑุณู ุฎูุงูู</li>
                        <li>ุญุงูุธ ุนูู ุงุณุชูุงูุฉ ุธูุฑู ูุตุฏุฑู ููุฃูุงู</li>
                        <li>ุงูุฒู ุญุชู ูุตุจุญ ูุฎุฐูู ููุงุฒููู ููุฃุฑุถ</li>
                        <li>ุงุฑูุน ุฌุณูู ูููุถุนูุฉ ุงูุจุฏุงุฆูุฉ</li>
                    </ol>
                </div>
            </div>

            <!-- ุชูุฑูู 3: ุชูุฑูู ุงูุจูุงูู -->
            <div class="exercise-card" onclick="selectExercise('plank')">
                <div class="exercise-icon">
                    <i class="fas fa-stopwatch"></i>
                </div>
                <h3 class="exercise-title">ุชูุฑูู ุงูุจูุงูู (Plank)</h3>
                <p class="exercise-desc">
                    <strong>ุงููุฌููุนุงุช ุงููุณุชูุฏูุฉ:</strong> ุนุถูุงุช ุงูุจุทูุ ุงูุธูุฑุ ุงููุชููู<br>
                    <strong>ุงููุณุชูู:</strong> ูุชูุณุท - ูุชูุฏู<br>
                    <strong>ุงููุฏุฉ ุงููุณุชูุฏูุฉ:</strong> 30-60 ุซุงููุฉ
                </p>
                <div style="background: rgba(0,190,159,0.1); padding: 10px; border-radius: 6px; margin-top: 10px;">
                    <strong style="color: #00be9f;">ููููุฉ ุงูุฃุฏุงุก:</strong>
                    <ol style="margin-right: 15px; margin-top: 8px; color: #ccc; font-size: 0.85rem;">
                        <li>ุงุณุชููู ุนูู ุจุทูู ุซู ุงุฑุชูุน ุนูู ุณุงุนุฏูู ูุฃุตุงุจุน ูุฏููู</li>
                        <li>ุญุงูุธ ุนูู ุงุณุชูุงูุฉ ุงูุฌุณู ูู ุงูุฑุฃุณ ุฅูู ุงููุฏููู</li>
                        <li>ุงุดุฏ ุนุถูุงุช ุจุทูู ูุงุจู ุธูุฑู ูุณุชูููุงู</li>
                        <li>ุชููุณ ุจุดูู ุทุจูุนู ูุงุจู ูู ูุฐู ุงููุถุนูุฉ</li>
                    </ol>
                </div>
            </div>

            <!-- ุชูุฑูู 4: ุชูุงุฑูู ุงููุงุฑุฏูู -->
            <div class="exercise-card" onclick="selectExercise('cardio')">
                <div class="exercise-icon">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <h3 class="exercise-title">ุชูุงุฑูู ุงููุงุฑุฏูู</h3>
                <p class="exercise-desc">
                    <strong>ุงููุฌููุนุงุช ุงููุณุชูุฏูุฉ:</strong> ุงูููุจุ ุงูุฑุฆุชููุ ุงูุชุญูู<br>
                    <strong>ุงููุณุชูู:</strong> ูุจุชุฏุฆ - ูุชูุฏู<br>
                    <strong>ุงููุฏุฉ ุงููุณุชูุฏูุฉ:</strong> 5-15 ุฏูููุฉ
                </p>
                <div style="background: rgba(0,190,159,0.1); padding: 10px; border-radius: 6px; margin-top: 10px;">
                    <strong style="color: #00be9f;">ุงูุฃููุงุน ุงููุชุงุญุฉ:</strong>
                    <ul style="margin-right: 15px; margin-top: 8px; color: #ccc; font-size: 0.85rem;">
                        <li><strong>ุงูุฌุฑู ูู ุงูููุงู:</strong> ุญุฑูุฉ ุณุฑูุนุฉ ูููุฏููู</li>
                        <li><strong>ุงูููุฒ:</strong> ููุฒ ุจูุชุญ ุงููุฏููู ูุงูุฐุฑุงุนูู</li>
                        <li><strong>ุฑูุน ุงูุฑูุจุชูู:</strong> ุฑูุน ุงูุฑูุจุชูู ุชุฌุงู ุงูุตุฏุฑ</li>
                        <li><strong>ุงูููุฒ ุนูู ุงูุญุจู:</strong> ุญุฑูุฉ ุงูููุฒ ุงููุชุชุงูู</li>
                    </ul>
                </div>
            </div>

            <!-- ุชูุฑูู 5: ุชูุงุฑูู ุงูุจุทู -->
            <div class="exercise-card" onclick="selectExercise('abs')">
                <div class="exercise-icon">
                    <i class="fas fa-user-md"></i>
                </div>
                <h3 class="exercise-title">ุชูุงุฑูู ุงูุจุทู</h3>
                <p class="exercise-desc">
                    <strong>ุงููุฌููุนุงุช ุงููุณุชูุฏูุฉ:</strong> ุนุถูุงุช ุงูุจุทู ุงูุณุชุฉ<br>
                    <strong>ุงููุณุชูู:</strong> ูุจุชุฏุฆ - ูุชูุฏู<br>
                    <strong>ุงูุชูุฑุงุฑุงุช ุงููุณุชูุฏูุฉ:</strong> 15-25
                </p>
                <div style="background: rgba(0,190,159,0.1); padding: 10px; border-radius: 6px; margin-top: 10px;">
                    <strong style="color: #00be9f;">ููููุฉ ุงูุฃุฏุงุก:</strong>
                    <ol style="margin-right: 15px; margin-top: 8px; color: #ccc; font-size: 0.85rem;">
                        <li>ุงุณุชููู ุนูู ุธูุฑู ูุน ุซูู ุงูุฑูุจุชูู</li>
                        <li>ุถุน ูุฏูู ุฎูู ุฑุฃุณู ุฃู ุนูู ุตุฏุฑู</li>
                        <li>ุงุฑูุน ุตุฏุฑู ูุญู ุฑูุจุชูู ูุน ุดุฏ ุงูุจุทู</li>
                        <li>ุงุฎูุถ ุฌุณูู ุจุจุทุก ูููุถุนูุฉ ุงูุจุฏุงุฆูุฉ</li>
                        <li>ูุฑุฑ ุงูุญุฑูุฉ ูุน ุงูุญูุงุธ ุนูู ุชููุณ ููุชุธู</li>
                    </ol>
                </div>
            </div>

            <!-- ุชูุฑูู 6: ุชูุงุฑูู ุงูุชูุฏุฏ -->
            <div class="exercise-card" onclick="selectExercise('stretching')">
                <div class="exercise-icon">
                    <i class="fas fa-spa"></i>
                </div>
                <h3 class="exercise-title">ุชูุงุฑูู ุงูุชูุฏุฏ ูุงูุฅุญูุงุก</h3>
                <p class="exercise-desc">
                    <strong>ุงููุฌููุนุงุช ุงููุณุชูุฏูุฉ:</strong> ุฌููุน ุงูุนุถูุงุชุ ุงููุฑููุฉ<br>
                    <strong>ุงููุณุชูู:</strong> ุฌููุน ุงููุณุชููุงุช<br>
                    <strong>ุงููุฏุฉ ุงููุณุชูุฏูุฉ:</strong> 5-10 ุฏูุงุฆู
                </p>
                <div style="background: rgba(0,190,159,0.1); padding: 10px; border-radius: 6px; margin-top: 10px;">
                    <strong style="color: #00be9f;">ุชูุงุฑูู ุฃุณุงุณูุฉ:</strong>
                    <ul style="margin-right: 15px; margin-top: 8px; color: #ccc; font-size: 0.85rem;">
                        <li><strong>ุชูุฏูุฏ ุงูุฐุฑุงุนูู:</strong> ููู ุงูุฑุฃุณ ูุฅูู ุงูุฌุงูุจูู</li>
                        <li><strong>ุชูุฏูุฏ ุงูุฑูุจุฉ:</strong> ุฏูุฑุงู ุงูุฑุฃุณ ุจูุทู</li>
                        <li><strong>ุชูุฏูุฏ ุงูุฃุฑุฌู:</strong> ุชูุฏูุฏ ุนุถูุงุช ุงููุฎุฐูู</li>
                        <li><strong>ุชูุฏูุฏ ุงูุธูุฑ:</strong> ุงูุงูุญูุงุก ุจูุทู ููุฃูุงู</li>
                        <li><strong>ุชูุฏูุฏ ุงููุชููู:</strong> ุชุฏููุฑ ุงูุฐุฑุงุนูู</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ูุธุงู ุงูุชุญุณุณ ุงููุชูุฏู -->
    <div class="camera-box" style="margin-top: 30px;">
        <h3 class="camera-title">
            <i class="fas fa-brain"></i> ูุธุงู ุงูุชุญุณุณ ุงูุฐูู ุงููุชูุฏู
        </h3>
        
        <div style="color: #ccc; line-height: 1.6; margin-bottom: 20px;">
            <p>โ <strong>ููุฒุงุช ุงูุชุญุณุณ ุงููุถุงูุฉ:</strong></p>
            <ul style="margin-right: 20px;">
                <li>๐ <strong>ูุดู ููุท ุงูุญุฑูุฉ:</strong> ูููุฒ ุจูู ุฃููุงุน ุงูุญุฑูุงุช ุงููุฎุชููุฉ</li>
                <li>โก <strong>ุชุญููู ุงูุณุฑุนุฉ ูุงูุชูููุช:</strong> ูููุณ ุชูููุช ุงูุญุฑูุฉ ุจุฏูุฉ</li>
                <li>๐ฏ <strong>ุชุตุญูุญ ุงููุถุนูุฉ:</strong> ููุชุดู ุงูุฃุฎุทุงุก ูู ุงููุถุนูุฉ</li>
                <li>๐ <strong>ุชุญููู ุงูุงุชุณุงู:</strong> ูููุณ ุงูุชุธุงู ุงูุชูุฑุงุฑุงุช</li>
                <li>๐ฅ <strong>ุชูููู ุงููุซุงูุฉ:</strong> ูุญุณุจ ุดุฏุฉ ุงูุชูุฑูู ุงูุญููููุฉ</li>
            </ul>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="formScore">0%</div>
                <div class="stat-label">ุฏูุฉ ุงููุถุนูุฉ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="consistencyScore">0%</div>
                <div class="stat-label">ุงุชุณุงู ุงูุญุฑูุฉ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="intensityLevel">ููุฎูุถ</div>
                <div class="stat-label">ุดุฏุฉ ุงูุชูุฑูู</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="motionPattern">--</div>
                <div class="stat-label">ููุท ุงูุญุฑูุฉ</div>
            </div>
        </div>

        <div class="feedback-box" style="margin-top: 20px;">
            <h4 class="feedback-title">
                <i class="fas fa-robot"></i> ุชุญููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
            </h4>
            <div id="aiAnalysis">
                <p>๐ <strong>ุฌุงุฑู ุชุญููู ุญุฑูุงุชู...</strong></p>
                <p id="formTips" style="color: #ffc107; margin-top: 10px; font-size: 0.9rem;">
                    โข ูู ุจุชูุงุฑููู ุฃูุงู ุงููุงููุฑุง ูุจุฏุก ุงูุชุญููู
                </p>
                <p id="improvementTips" style="color: #00be9f; margin-top: 10px; font-size: 0.9rem;">
                    โข ุญุงูุธ ุนูู ุงุณุชูุงูุฉ ุธูุฑู ุฎูุงู ุฌููุน ุงูุชูุงุฑูู
                </p>
            </div>
        </div>
    </div>

    <!-- ุฌุฏูู ุงูุชูุฏู -->
    <div class="camera-box" style="margin-top: 20px;">
        <h3 class="camera-title">
            <i class="fas fa-chart-line"></i> ูุชุงุจุนุฉ ุงูุชูุฏู ุงูุชุฏุฑูุฌู
        </h3>
        
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; color: #ccc;">
                <thead>
                    <tr style="background: rgba(0,190,159,0.2);">
                        <th style="padding: 12px; text-align: right; border: 1px solid rgba(0,190,159,0.5);">ุงูููู</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid rgba(0,190,159,0.5);">ุงูุชูุฑุงุฑุงุช</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid rgba(0,190,159,0.5);">ุงูุฏูุฉ</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid rgba(0,190,159,0.5);">ุงููุฏุฉ</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid rgba(0,190,159,0.5);">ุงูุชูููู</th>
                    </tr>
                </thead>
                <tbody id="progressTable">
                    <tr>
                        <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: right;">ุงูููู</td>
                        <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: center;">0</td>
                        <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: center;">0%</td>
                        <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: center;">00:00</td>
                        <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: center;">--</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div style="margin-top: 15px; text-align: center;">
            <button class="trainer-btn secondary" onclick="saveWorkoutProgress()" style="margin: 0 5px;">
                <i class="fas fa-save"></i> ุญูุธ ุงูุชูุฏู
            </button>
            <button class="trainer-btn secondary" onclick="viewProgressHistory()" style="margin: 0 5px;">
                <i class="fas fa-history"></i> ุนุฑุถ ุงูุณุฌู
            </button>
        </div>
    </div>

    <!-- ุฅุฑุดุงุฏุงุช ุงููุฏุฑุจ -->
    <div class="camera-box" style="margin-top: 20px;">
        <h3 class="camera-title">
            <i class="fas fa-user-tie"></i> ุฅุฑุดุงุฏุงุช ุงููุฏุฑุจ ุงูุดุฎุตู
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; border-left: 4px solid #00be9f;">
                <h4 style="color: #00be9f; margin-bottom: 10px;">
                    <i class="fas fa-bullseye"></i> ูุตุงุฆุญ ูุจู ุงูุชูุฑูู
                </h4>
                <ul style="color: #ccc; margin-right: 15px; font-size: 0.9rem;">
                    <li>๐น ูู ุจุชูุงุฑูู ุงูุฅุญูุงุก ููุฏุฉ 5-10 ุฏูุงุฆู</li>
                    <li>๐น ุงุดุฑุจ ูููุฉ ูุงููุฉ ูู ุงููุงุก</li>
                    <li>๐น ุงุฑุชุฏ ููุงุจุณ ูุฑูุญุฉ ูููุงุณุจุฉ</li>
                    <li>๐น ุชุฃูุฏ ูู ูุฌูุฏ ูุณุงุญุฉ ุขููุฉ ููุชูุฑูู</li>
                    <li>๐น ุถุน ูุฏูุงู ูุงูุนูุงู ููู ุฌูุณุฉ</li>
                </ul>
            </div>
            
            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                <h4 style="color: #ffc107; margin-bottom: 10px;">
                    <i class="fas fa-running"></i> ุฃุซูุงุก ุงูุชูุฑูู
                </h4>
                <ul style="color: #ccc; margin-right: 15px; font-size: 0.9rem;">
                    <li>๐ธ ุชููุณ ุจุดูู ุตุญูุญ (ุดููู ูุฒููุฑ)</li>
                    <li>๐ธ ุญุงูุธ ุนูู ุงุณุชูุงูุฉ ุงูุธูุฑ</li>
                    <li>๐ธ ุงูุชุจู ููุทุงู ุงูุญุฑูุฉ ุงููุงูู</li>
                    <li>๐ธ ุงุณุชูุน ูุฌุณูู ููุง ุชูุฑุท</li>
                    <li>๐ธ ุฑูุฒ ุนูู ุฌูุฏุฉ ุงูุญุฑูุฉ ูููุณ ุงููููุฉ</li>
                </ul>
            </div>
            
            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; border-left: 4px solid #ff416c;">
                <h4 style="color: #ff416c; margin-bottom: 10px;">
                    <i class="fas fa-heart"></i> ุจุนุฏ ุงูุชูุฑูู
                </h4>
                <ul style="color: #ccc; margin-right: 15px; font-size: 0.9rem;">
                    <li>๐บ ูู ุจุชูุงุฑูู ุงูุชูุฏุฆุฉ ูุงูุชูุฏุฏ</li>
                    <li>๐บ ุงุดุฑุจ ุงููุงุก ูุชุนููุถ ุงูุณูุงุฆู</li>
                    <li>๐บ ุณุฌู ุฅูุฌุงุฒุงุชู ูุชูุฏูู</li>
                    <li>๐บ ุญุงูุธ ุนูู ุชุบุฐูุฉ ูุชูุงุฒูุฉ</li>
                    <li>๐บ ุงุญุตู ุนูู ูุณุท ูุงู ูู ุงูุฑุงุญุฉ</li>
                </ul>
            </div>
        </div>
    </div>
</main>

<footer>
    <div class="copyright">
        ุฌููุน ุงูุญููู ูุญููุธุฉ &copy; 2026 
        <a href="https://www.instagram.com/talel_chebbi4?igsh=YzI5ZmEzbnpua2F5" target="_blank" rel="noopener noreferrer">By Daniel Ai</a>
    </div>
</footer>

<script>

        function openMusicPlayer() {
        window.open('music-player.html', 'MusicPlayer', 
            'width=450,height=700,left=100,top=100,resizable=yes,scrollbars=yes');
    }
// ============ ูุธุงู ูุดู ุงูุญุฑูุฉ ุงูุญูููู ============

// ุงููุชุบูุฑุงุช ุงูุนุงูุฉ
let cameraStream = null;
let isCameraActive = false;
let motionDetectorActive = false;
let sessionStartTime = null;
let sessionTimer = null;
let lastFrame = null;
let motionHistory = [];
let repCount = 0;
let totalMotion = 0;
let consecutiveMotionFrames = 0;
let lastRepTime = 0;
let repCooldown = 1000; // 1 ุซุงููุฉ ุจูู ุงูุชูุฑุงุฑุงุช
let motionThreshold = 30; // ุงูุญุฏ ุงูุฃุฏูู ููุญุฑูุฉ
let exerciseTarget = 20; // ุงููุฏู ุงูุงูุชุฑุงุถู

// ุฅุญุตุงุฆูุงุช ุงูุญุฑูุฉ
let motionStats = {
    totalFrames: 0,
    motionFrames: 0,
    maxMotion: 0,
    avgMotion: 0
};

// ูุธุงู ุงูุชูุงุฑูู ุงููุชูุฏู
let selectedExercise = null;
let exercisePatterns = {
    pushups: { name: "ุชูุฑูู ุงูุถุบุท", target: 20, motionPattern: "vertical" },
    squats: { name: "ุชูุฑูู ุงููุฑูุตุงุก", target: 30, motionPattern: "vertical" },
    plank: { name: "ุชูุฑูู ุงูุจูุงูู", target: 60, motionPattern: "static" },
    cardio: { name: "ุชูุงุฑูู ุงููุงุฑุฏูู", target: 10, motionPattern: "fast" },
    abs: { name: "ุชูุงุฑูู ุงูุจุทู", target: 25, motionPattern: "situp" },
    stretching: { name: "ุชูุงุฑูู ุงูุชูุฏุฏ", target: 5, motionPattern: "slow" }
};

// ุชุญููู ูุชูุฏู ููุญุฑูุฉ
let advancedMotionData = {
    formScore: 0,
    consistency: 0,
    intensity: "ููุฎูุถ",
    pattern: "ุบูุฑ ูุญุฏุฏ",
    movementHistory: []
};

// ูุธุงู ุญูุธ ุงูุชูุฏู
let workoutHistory = JSON.parse(localStorage.getItem('workoutHistory')) || [];

// ุชุญุณููุงุช ุงูุฃุฏุงุก
const motionBuffer = [];
const BUFFER_SIZE = 5;

// ============ ุชููุฆุฉ ุงููุธุงู ============
document.addEventListener('DOMContentLoaded', () => {
    // ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู
    const loggedUser = JSON.parse(localStorage.getItem('loggedInUser'));
    const userInfo = document.getElementById('userInfo');
    const loginBtn = document.getElementById('loginBtn');
    const displayName = document.getElementById('displayName');
    const userAvatar = document.getElementById('userAvatar');

    if (loggedUser) {
        displayName.textContent = loggedUser.username || "ูุณุชุฎุฏู";
        userAvatar.src = loggedUser.avatar || "default-avatar.png";
        userInfo.style.display = "flex";
        loginBtn.style.display = "none";
    } else {
        userInfo.style.display = "none";
        loginBtn.style.display = "inline-flex";
    }
    
    // ุชููุฆุฉ ุงูุฌุฏูู
    setTimeout(updateProgressTable, 1000);
    
    // ุนุฑุถ ุงูุชูุงุฑูู ุงูุชุฑุงุถูุงู
    setTimeout(() => {
        const exercisesSection = document.getElementById('exercisesSection');
        if (exercisesSection) {
            exercisesSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }, 2000);
});

// ============ ุฅุฏุงุฑุฉ ุงููุงููุฑุง ============
async function startCamera() {
    try {
        // ุทูุจ ุตูุงุญูุงุช ุงููุงููุฑุง
        const constraints = {
            video: {
                width: { ideal: 640 },
                height: { ideal: 480 },
                facingMode: 'user',
                frameRate: { ideal: 30 }
            },
            audio: false
        };

        cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
        const videoElement = document.getElementById('cameraFeed');
        videoElement.srcObject = cameraStream;
        
        videoElement.onloadedmetadata = async () => {
            await videoElement.play();
            
            // ุฅุฎูุงุก ุงูุนูุตุฑ ุงููุงุฆุจ ูุฅุธูุงุฑ ุงูููุฏูู
            document.getElementById('cameraPlaceholder').style.display = 'none';
            videoElement.style.display = 'block';
            
            isCameraActive = true;
            motionDetectorActive = true;
            
            // ุชุญุฏูุซ ุงูุฃุฒุฑุงุฑ
            document.getElementById('startCamera').style.display = 'none';
            document.getElementById('stopCamera').style.display = 'flex';
            document.getElementById('motionAnalysis').style.display = 'block';
            document.getElementById('repProgress').style.display = 'block';
            
            // ุจุฏุก ุงูุฌูุณุฉ
            startTrainingSession();
            
            // ุจุฏุก ูุดู ุงูุญุฑูุฉ
            startMotionDetection();
            
            showFeedback('โ ุชู ุชุดุบูู ุงููุงููุฑุง ุจูุฌุงุญ! ุงุจุฏุฃ ุจุงูุญุฑูุฉ ุฃูุงู ุงููุงููุฑุง.');
            showAlert('๐ ุงููุธุงู ุฌุงูุฒ ููุดู ุงูุญุฑูุฉ. ูู ุจุญุฑูุงุช ุฑูุงุถูุฉ ูุงุถุญุฉ.');
        };
        
    } catch (error) {
        console.error('ุฎุทุฃ ูู ุงููุงููุฑุง:', error);
        showFeedback('โ ุชุนุฐุฑ ุชุดุบูู ุงููุงููุฑุง. ุชุฃูุฏ ูู ุงูุณูุงุญ ุจุงุณุชุฎุฏุงู ุงููุงููุฑุง.');
        showAlert('โ๏ธ ูุฑุฌู ุงูุณูุงุญ ุจุงุณุชุฎุฏุงู ุงููุงููุฑุง ุซู ุฅุนุงุฏุฉ ุงููุญุงููุฉ.', 'warning');
    }
}

function stopCamera() {
    if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
        cameraStream = null;
    }

    isCameraActive = false;
    motionDetectorActive = false;
    
    // ุฅุนุงุฏุฉ ุงูุนูุงุตุฑ ุฅูู ูุถุนูุง ุงูุฃุตูู
    document.getElementById('cameraPlaceholder').style.display = 'flex';
    document.getElementById('cameraFeed').style.display = 'none';
    document.getElementById('startCamera').style.display = 'flex';
    document.getElementById('stopCamera').style.display = 'none';
    document.getElementById('motionAnalysis').style.display = 'none';
    
    // ุฅููุงู ุงูุฌูุณุฉ
    stopTrainingSession();
    
    showFeedback('ุชู ุฅููุงู ุงููุงููุฑุง. ููููู ุฅุนุงุฏุฉ ุงูุชุดุบูู ุนูุฏ ุงูุญุงุฌุฉ.');
}

function resetCounters() {
    repCount = 0;
    totalMotion = 0;
    motionStats = {
        totalFrames: 0,
        motionFrames: 0,
        maxMotion: 0,
        avgMotion: 0
    };
    
    advancedMotionData = {
        formScore: 0,
        consistency: 0,
        intensity: "ููุฎูุถ",
        pattern: "ุบูุฑ ูุญุฏุฏ",
        movementHistory: []
    };
    
    document.getElementById('repsCount').textContent = '0';
    document.getElementById('accuracyScore').textContent = '0%';
    document.getElementById('caloriesBurned').textContent = '0';
    document.getElementById('motionLevel').textContent = '0%';
    document.getElementById('motionSpeed').textContent = '0';
    document.getElementById('motionArea').textContent = '0%';
    document.getElementById('formScore').textContent = '0%';
    document.getElementById('consistencyScore').textContent = '0%';
    document.getElementById('intensityLevel').textContent = 'ููุฎูุถ';
    document.getElementById('motionPattern').textContent = '--';
    
    updateProgress();
    showFeedback('ุชู ุฅุนุงุฏุฉ ุชุนููู ุงูุนุฏุงุฏุงุช. ุงุจุฏุฃ ูู ุฌุฏูุฏ!');
    showAlert('๐ ุชู ุฅุนุงุฏุฉ ุงูุชุนููู. ุฌุงูุฒ ููุจุฏุก ูู ุฌุฏูุฏ!');
}

// ============ ูุดู ุงูุญุฑูุฉ ุงูุญูููู ============
async function startMotionDetection() {
    if (!isCameraActive) return;
    
    const video = document.getElementById('cameraFeed');
    const canvas = document.getElementById('motionCanvas');
    const ctx = canvas.getContext('2d');
    
    // ุถุจุท ุฃุจุนุงุฏ ุงููุงููุงุณ
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    
    let prevFrame = null;
    
    async function detectMotion() {
        if (!motionDetectorActive || !isCameraActive) return;
        
        try {
            // ุฑุณู ุงูุฅุทุงุฑ ุงูุญุงูู ุนูู ุงููุงููุงุณ
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const currentFrame = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            if (prevFrame) {
                // ุญุณุงุจ ุงููุฑู ุจูู ุงูุฅุทุงุฑุงุช
                const motion = calculateFrameDifference(prevFrame, currentFrame);
                
                // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
                updateMotionStats(motion);
                
                // ุชุญููู ุงูุญุฑูุฉ ูุงูุชุดุงู ุงูุชูุฑุงุฑุงุช
                analyzeMotionForReps(motion);
                
                // ุงูุชุญููู ุงููุชูุฏู ุฅุฐุง ูุงู ููุงู ุชูุฑูู ูุญุฏุฏ
                if (selectedExercise) {
                    analyzeAdvancedMotion(motion);
                }
                
                // ุฑุณู ููุงุทู ุงูุญุฑูุฉ ุนูู ุงููุงููุงุณ
                drawMotionAreas(currentFrame, prevFrame);
            }
            
            // ุญูุธ ุงูุฅุทุงุฑ ุงูุญุงูู ููุณุงุจูุฉ
            prevFrame = currentFrame;
            
            // ุทูุจ ุงูุฅุทุงุฑ ุงูุชุงูู
            requestAnimationFrame(detectMotion);
            
        } catch (error) {
            console.error('ุฎุทุฃ ูู ูุดู ุงูุญุฑูุฉ:', error);
            setTimeout(detectMotion, 100);
        }
    }
    
    detectMotion();
}

function calculateFrameDifference(frame1, frame2) {
    const width = frame1.width;
    const height = frame1.height;
    const data1 = frame1.data;
    const data2 = frame2.data;
    
    let totalDiff = 0;
    let motionPixels = 0;
    let maxDiff = 0;
    
    // ุชุญููู ูู ุจูุณู
    for (let i = 0; i < data1.length; i += 4) {
        // ุญุณุงุจ ุงููุฑู ุจูู ููู RGB
        const rDiff = Math.abs(data1[i] - data2[i]);
        const gDiff = Math.abs(data1[i + 1] - data2[i + 1]);
        const bDiff = Math.abs(data1[i + 2] - data2[i + 2]);
        
        const diff = (rDiff + gDiff + bDiff) / 3;
        
        if (diff > motionThreshold) {
            motionPixels++;
            totalDiff += diff;
            if (diff > maxDiff) maxDiff = diff;
        }
    }
    
    // ุญุณุงุจ ุงููุณุจุฉ ุงููุฆููุฉ ููุญุฑูุฉ
    const motionPercentage = (motionPixels / (width * height)) * 100;
    const avgDiff = motionPixels > 0 ? totalDiff / motionPixels : 0;
    
    const result = {
        percentage: motionPercentage,
        pixels: motionPixels,
        averageDiff: avgDiff,
        maxDiff: maxDiff,
        timestamp: Date.now()
    };
    
    // ุฅุถุงูุฉ ููุจุงูุฑ ูููุนุงูุฌุฉ ุงูููุณุงุก
    addToMotionBuffer(result);
    
    // ุงุณุชุฎุฏุงู ุงูุญุฑูุฉ ุงูููุณุงุก ุนูุฏ ุงูุญุงุฌุฉ
    if (motionBuffer.length >= BUFFER_SIZE) {
        const smoothed = getSmoothedMotion();
        if (smoothed) {
            result.percentage = smoothed.percentage;
        }
    }
    
    return result;
}

function addToMotionBuffer(motion) {
    motionBuffer.push(motion);
    if (motionBuffer.length > BUFFER_SIZE) {
        motionBuffer.shift();
    }
}

function getSmoothedMotion() {
    if (motionBuffer.length === 0) return null;
    
    let total = 0;
    for (const motion of motionBuffer) {
        total += motion.percentage;
    }
    
    return {
        percentage: total / motionBuffer.length,
        smoothed: true
    };
}

function updateMotionStats(motion) {
    // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
    motionStats.totalFrames++;
    
    if (motion.percentage > 0.1) {
        motionStats.motionFrames++;
    }
    
    if (motion.percentage > motionStats.maxMotion) {
        motionStats.maxMotion = motion.percentage;
    }
    
    // ุชุญุฏูุซ ูุชูุณุท ุงูุญุฑูุฉ
    motionStats.avgMotion = (motionStats.avgMotion * (motionStats.totalFrames - 1) + motion.percentage) / motionStats.totalFrames;
    
    // ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู
    document.getElementById('motionLevel').textContent = motion.percentage.toFixed(1) + '%';
    document.getElementById('motionSpeed').textContent = motion.averageDiff.toFixed(1);
    document.getElementById('motionArea').textContent = ((motion.pixels / (640 * 480)) * 100).toFixed(1) + '%';
    
    // ุชุญุฏูุซ ูุคุดุฑ ุงููุดุงุท
    const activityLevel = Math.min(100, motion.percentage * 3);
    document.getElementById('activityFill').style.width = activityLevel + '%';
    
    // ุชุญุฏูุซ ูุคุดุฑ ุงูุญุฑูุฉ
    const indicator = document.getElementById('motionIndicator');
    const status = document.getElementById('motionStatus');
    const details = document.getElementById('motionDetails');
    
    if (motion.percentage > 5) {
        indicator.className = 'motion-indicator active';
        indicator.style.background = '#00ff00';
        status.textContent = 'ุญุฑูุฉ ูุดุทุฉ';
        status.style.color = '#00ff00';
        details.textContent = `ูุดู ุญุฑูุฉ ุจููุฉ ${motion.percentage.toFixed(1)}%`;
    } else if (motion.percentage > 1) {
        indicator.className = 'motion-indicator';
        indicator.style.background = '#ffc107';
        status.textContent = 'ุญุฑูุฉ ุฎูููุฉ';
        status.style.color = '#ffc107';
        details.textContent = 'ุญุฑูุฉ ุทูููุฉ ูู ุงููุดูุฏ';
    } else {
        indicator.className = 'motion-indicator';
        indicator.style.background = '#666';
        status.textContent = 'ูุง ุชูุฌุฏ ุญุฑูุฉ';
        status.style.color = '#ccc';
        details.textContent = 'ููุชุธุฑ ุงูุชุดุงู ุญุฑูุฉ...';
    }
}

function analyzeMotionForReps(motion) {
    const now = Date.now();
    
    // ุฅุฐุง ูุงูุช ููุงู ุญุฑูุฉ ูุงููุฉ
    if (motion.percentage > 2) {
        consecutiveMotionFrames++;
        
        // ุฅุฐุง ุงุณุชูุฑุช ุงูุญุฑูุฉ ููุชุฑุฉ ูุงููุฉ ููุงูุช ูููุฉุ ุงุญุณุจูุง ูุชูุฑุงุฑ
        if (consecutiveMotionFrames > 5 && motion.percentage > 3 && (now - lastRepTime) > repCooldown) {
            // ุฒูุงุฏุฉ ุนุฏุงุฏ ุงูุชูุฑุงุฑุงุช
            repCount++;
            lastRepTime = now;
            
            // ุชุญุฏูุซ ุงููุงุฌูุฉ ูุน ุชุฃุซูุฑ
            document.getElementById('repsCount').textContent = repCount;
            document.getElementById('repsCount').classList.add('rep-animation');
            setTimeout(() => {
                document.getElementById('repsCount').classList.remove('rep-animation');
            }, 500);
            
            // ุชุญุฏูุซ ุงูุฏูุฉ
            const accuracy = calculateAccuracy(motion);
            document.getElementById('accuracyScore').textContent = accuracy + '%';
            
            // ุชุญุฏูุซ ุงูุชูุฏู
            updateProgress();
            
            // ุฅุธูุงุฑ ุชูุจูู
            showAlert(`๐ ุญุฑูุฉ #${repCount} ุชู ุงูุชุดุงููุง! ุงุณุชูุฑ ูู ุงูุชูุฏู!`);
            
            // ุฅุนุทุงุก ุชูุฌููุงุช
            provideMotionFeedback(motion, accuracy);
        }
    } else {
        consecutiveMotionFrames = 0;
    }
    
    // ุชุญุฏูุซ ุฅุฌูุงูู ุงูุญุฑูุฉ
    totalMotion += motion.percentage;
}

function calculateAccuracy(motion) {
    // ุญุณุงุจ ุงูุฏูุฉ ุจูุงุกู ุนูู ุฌูุฏุฉ ุงูุญุฑูุฉ
    const baseAccuracy = 70;
    const motionBonus = Math.min(30, motion.percentage * 2);
    const consistencyBonus = (motionStats.motionFrames / motionStats.totalFrames) * 20;
    
    return Math.min(100, Math.round(baseAccuracy + motionBonus + consistencyBonus));
}

function updateProgress() {
    const progress = (repCount / exerciseTarget) * 100;
    document.getElementById('progressFill').style.width = Math.min(100, progress) + '%';
    document.getElementById('progressText').textContent = Math.round(progress) + '%';
    
    // ุฅุฐุง ูุตู ูููุฏู
    if (repCount >= exerciseTarget) {
        showFeedback('๐ ูุจุฑูู! ููุฏ ูุตูุช ูููุฏู! ููููู ุงูุงุณุชูุฑุงุฑ ุฃู ุฅุนุงุฏุฉ ุงูุชุนููู.');
        showAlert('๐ ููุฏ ุฃุชููุช ุงููุฏู ุจูุฌุงุญ! ุฃุญุณูุช ุงูุนูู!');
    }
}

function provideMotionFeedback(motion, accuracy) {
    let feedback = '';
    
    if (motion.percentage > 10) {
        feedback = '๐ช ุญุฑูุฉ ูููุฉ! ูุฐุง ููุชุงุฒ ููุนุถูุงุช';
    } else if (motion.percentage > 5) {
        feedback = '๐ ุญุฑูุฉ ุฌูุฏุฉ! ุญุงูุธ ุนูู ูุฐุง ุงููุณุชูู';
    } else {
        feedback = '๐ ุญุฑูุฉ ุฎูููุฉุ ุญุงูู ุชูุจูุฑ ุงูุญุฑูุฉ ููููุงู';
    }
    
    if (accuracy > 90) {
        feedback += '<br>๐ฏ ุฏูุชู ููุชุงุฒุฉ!';
    } else if (accuracy > 70) {
        feedback += '<br>โ ุฏูุฉ ุฌูุฏุฉุ ุงุณุชูุฑ!';
    } else {
        feedback += '<br>โ๏ธ ุญุงูู ุชุญุณูู ุงุณุชูุฑุงุฑ ุงูุญุฑูุฉ';
    }
    
    // ุฅุถุงูุฉ ุชูููุน ุงููุฏุฑุจ ุงูุฐูู
    feedback += `
        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,190,159,0.3); font-size: 0.8rem; color: #00be9f;">
            <i class="fas fa-robot"></i> ุงููุฏุฑุจ ุงูุฐูู - ูุธุงู ุงูุชุญุณุณ ุงููุชูุฏู
        </div>
    `;
    
    showFeedback(feedback);
}

function drawMotionAreas(currentFrame, prevFrame) {
    const canvas = document.getElementById('motionCanvas');
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    
    // ุฅูุดุงุก ุตูุฑุฉ ููุญุฑูุฉ
    const motionImage = ctx.createImageData(width, height);
    const data1 = prevFrame.data;
    const data2 = currentFrame.data;
    const motionData = motionImage.data;
    
    // ุฑุณู ููุงุทู ุงูุญุฑูุฉ
    for (let i = 0; i < data1.length; i += 4) {
        const rDiff = Math.abs(data1[i] - data2[i]);
        const gDiff = Math.abs(data1[i + 1] - data2[i + 1]);
        const bDiff = Math.abs(data1[i + 2] - data2[i + 2]);
        const diff = (rDiff + gDiff + bDiff) / 3;
        
        if (diff > motionThreshold) {
            // ุฑุณู ุงูุญุฑูุฉ ุจุงูุฃุญูุฑ
            motionData[i] = 255;     // R
            motionData[i + 1] = 0;   // G
            motionData[i + 2] = 0;   // B
            motionData[i + 3] = 100; // A
        } else {
            // ุดูุงููุฉ
            motionData[i] = 0;
            motionData[i + 1] = 0;
            motionData[i + 2] = 0;
            motionData[i + 3] = 0;
        }
    }
    
    // ุฑุณู ููุงุทู ุงูุญุฑูุฉ ุนูู ุงููุงููุงุณ
    ctx.putImageData(motionImage, 0, 0);
}

// ============ ูุธุงู ุงูุชูุงุฑูู ุงููุชูุฏู ============
function selectExercise(exerciseId) {
    selectedExercise = exerciseId;
    const exercise = exercisePatterns[exerciseId];
    
    // ุชุญุฏูุซ ูุงุฌูุฉ ุงูุชูุฑูู ุงููุญุฏุฏ
    document.querySelectorAll('.exercise-card').forEach(card => {
        card.classList.remove('active');
    });
    event.currentTarget.classList.add('active');
    
    // ุชุญุฏูุซ ุงููุฏู
    exerciseTarget = exercise.target;
    
    // ุฅุธูุงุฑ ุชุนูููุงุช ุงูุชูุฑูู
    showFeedback(`
        <strong>๐ฏ ุชู ุงุฎุชูุงุฑ ${exercise.name}</strong><br>
        <span style="color: #00ffcc;">ุงููุฏู: ${exercise.target} ุชูุฑุงุฑ/ุซุงููุฉ</span><br>
        <span style="color: #ccc; font-size: 0.9rem;">ูู ุฃูุงู ุงููุงููุฑุง ูุงุจุฏุฃ ุงูุชูุฑูู</span>
    `);
    
    // ุชุญุฏูุซ ุชุญููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
    updateAIAnalysis(exercise);
    
    // ุฅุธูุงุฑ ุชูุจูู
    showAlert(`๐๏ธ ุชู ุงุฎุชูุงุฑ ${exercise.name}. ุฌุงูุฒ ููุจุฏุก!`);
}

function updateAIAnalysis(exercise) {
    const formTips = document.getElementById('formTips');
    const improvementTips = document.getElementById('improvementTips');
    
    let tips = "";
    let improvements = "";
    
    switch(exercise.name) {
        case "ุชูุฑูู ุงูุถุบุท":
            tips = "โข ุญุงูุธ ุนูู ุงุณุชูุงูุฉ ุงูุฌุณู<br>โข ุงุฎูุถ ุงูุตุฏุฑ ูุญู ุงูุฃุฑุถ<br>โข ุงุฏูุน ุจููุฉ ูุฃุนูู";
            improvements = "โข ุชุฌูุจ ุฎูุถ ุงูุญูุถ<br>โข ุญุงูุธ ุนูู ูุฑูููู ูุฑูุจูู ูู ุงูุฌุณู";
            break;
        case "ุชูุฑูู ุงููุฑูุตุงุก":
            tips = "โข ุญุงูุธ ุนูู ุธูุฑ ูุณุชููู<br>โข ุงูุฒู ุญุชู ููุงุฒุงุฉ ุงููุฎุฐูู<br>โข ุฏูุน ูู ุงููุนุจูู";
            improvements = "โข ุชุฌูุจ ุงูุญูุงุก ุงูุธูุฑ<br>โข ูุง ุชุณูุญ ููุฑูุจุชูู ุจุงูุงูุญุฑุงู";
            break;
        case "ุชูุฑูู ุงูุจูุงูู":
            tips = "โข ุญุงูุธ ุนูู ุงุณุชูุงูุฉ ุงูุฌุณู<br>โข ุดุฏ ุงูุจุทู ูุงูุงุฑุฏุงู<br>โข ุชููุณ ุจุดูู ููุชุธู";
            improvements = "โข ุชุฌูุจ ุฑูุน ุงูุญูุถ ุนุงููุงู<br>โข ูุง ุชุฑูู ุฑูุจุชู";
            break;
        default:
            tips = "โข ูู ุจุญุฑูุงุช ูุงููุฉ ููุงุถุญุฉ<br>โข ุญุงูุธ ุนูู ุงูุชุธุงู ุงูุชููุณ<br>โข ุงุณุชูุน ูุฌุณุฏู";
            improvements = "โข ุญุงูุธ ุนูู ุงุณุชูุฑุงุฑ ุงูุญุฑูุฉ<br>โข ูุง ุชุชุนุฌู ูู ุงูุชูุฑุงุฑุงุช";
    }
    
    formTips.innerHTML = tips;
    improvementTips.innerHTML = improvements;
}

// ุชุญููู ุงููุถุนูุฉ ุงููุชูุฏู
function analyzeAdvancedMotion(motion) {
    if (!selectedExercise) return;
    
    // ุญุณุงุจ ุฏูุฉ ุงููุถุนูุฉ
    const stabilityScore = calculateStabilityScore(motion);
    const rangeScore = calculateRangeOfMotion(motion);
    const timingScore = calculateTimingScore();
    
    advancedMotionData.formScore = Math.round((stabilityScore + rangeScore + timingScore) / 3);
    
    // ุญุณุงุจ ุงูุงุชุณุงู
    advancedMotionData.movementHistory.push(motion.percentage);
    if (advancedMotionData.movementHistory.length > 10) {
        advancedMotionData.movementHistory.shift();
    }
    
    const consistency = calculateConsistency(advancedMotionData.movementHistory);
    advancedMotionData.consistency = consistency;
    
    // ุชุญุฏูุฏ ุดุฏุฉ ุงูุชูุฑูู
    if (motion.percentage > 15) {
        advancedMotionData.intensity = "ุนุงููุฉ";
    } else if (motion.percentage > 8) {
        advancedMotionData.intensity = "ูุชูุณุทุฉ";
    } else {
        advancedMotionData.intensity = "ููุฎูุถุฉ";
    }
    
    // ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู
    updateAdvancedUI();
}

function calculateStabilityScore(motion) {
    // ุชุญููู ุงุณุชูุฑุงุฑ ุงูุญุฑูุฉ
    const variance = calculateVariance(advancedMotionData.movementHistory);
    let score = 100;
    
    if (variance > 50) score -= 40;
    else if (variance > 30) score -= 20;
    else if (variance > 15) score -= 10;
    
    return Math.max(0, score);
}

function calculateRangeOfMotion(motion) {
    // ุชุญููู ูุทุงู ุงูุญุฑูุฉ
    const exercise = exercisePatterns[selectedExercise];
    let score = 70;
    
    if (exercise.motionPattern === "vertical") {
        if (motion.percentage > 12) score += 20;
        else if (motion.percentage > 6) score += 10;
    } else if (exercise.motionPattern === "fast") {
        if (motion.percentage > 20) score += 20;
        else if (motion.percentage > 10) score += 10;
    }
    
    return Math.min(100, score);
}

function calculateTimingScore() {
    // ุชุญููู ุชูููุช ุงูุญุฑูุฉ
    const now = Date.now();
    const timeSinceLastRep = now - lastRepTime;
    let score = 80;
    
    if (selectedExercise === "plank") {
        // ููุชูุงุฑูู ุงูุซุงุจุชุฉ
        if (timeSinceLastRep > 30000) score += 15;
    } else {
        // ููุชูุงุฑูู ุงูุฏููุงููููุฉ
        const idealTiming = 2000; // 2 ุซุงููุฉ ููู ุชูุฑุงุฑ
        const diff = Math.abs(timeSinceLastRep - idealTiming);
        if (diff < 500) score += 15;
        else if (diff < 1000) score += 5;
        else if (diff > 2000) score -= 10;
    }
    
    return Math.max(0, Math.min(100, score));
}

function calculateConsistency(history) {
    if (history.length < 3) return 0;
    
    let sum = 0;
    let sumSq = 0;
    
    for (const value of history) {
        sum += value;
        sumSq += value * value;
    }
    
    const mean = sum / history.length;
    const variance = (sumSq / history.length) - (mean * mean);
    
    // ุชุญููู ุงูุชุจุงูู ุฅูู ูุณุจุฉ ุงุชุณุงู
    const maxVariance = 100;
    const consistency = Math.max(0, 100 - (variance / maxVariance * 100));
    
    return Math.round(consistency);
}

function calculateVariance(array) {
    if (array.length === 0) return 0;
    
    const mean = array.reduce((a, b) => a + b) / array.length;
    const squaredDiffs = array.map(value => Math.pow(value - mean, 2));
    const variance = squaredDiffs.reduce((a, b) => a + b) / array.length;
    
    return variance;
}

function updateAdvancedUI() {
    // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุงููุชูุฏูุฉ
    document.getElementById('formScore').textContent = advancedMotionData.formScore + '%';
    document.getElementById('consistencyScore').textContent = advancedMotionData.consistency + '%';
    document.getElementById('intensityLevel').textContent = advancedMotionData.intensity;
    
    // ุชุญุฏูุซ ููุท ุงูุญุฑูุฉ
    if (selectedExercise) {
        const pattern = exercisePatterns[selectedExercise].motionPattern;
        let patternText = "";
        
        switch(pattern) {
            case "vertical": patternText = "ุนููุฏู"; break;
            case "static": patternText = "ุซุงุจุช"; break;
            case "fast": patternText = "ุณุฑูุน"; break;
            case "situp": patternText = "ุฌููุณ"; break;
            case "slow": patternText = "ุจุทูุก"; break;
            default: patternText = "ุฏููุงูููู";
        }
        
        document.getElementById('motionPattern').textContent = patternText;
    }
}

// ============ ุฅุฏุงุฑุฉ ุฌูุณุฉ ุงูุชุฏุฑูุจ ============
function startTrainingSession() {
    sessionStartTime = Date.now();
    
    // ุฅุนุงุฏุฉ ุชุนููู ุงูุฅุญุตุงุฆูุงุช
    repCount = 0;
    totalMotion = 0;
    motionStats = {
        totalFrames: 0,
        motionFrames: 0,
        maxMotion: 0,
        avgMotion: 0
    };
    
    document.getElementById('repsCount').textContent = '0';
    document.getElementById('accuracyScore').textContent = '0%';
    document.getElementById('caloriesBurned').textContent = '0';
    document.getElementById('sessionTime').textContent = '00:00';
    
    // ุจุฏุก ุงููุคูุช
    sessionTimer = setInterval(() => {
        const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
        const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
        const seconds = (elapsed % 60).toString().padStart(2, '0');
        document.getElementById('sessionTime').textContent = `${minutes}:${seconds}`;
        
        // ุญุณุงุจ ุงูุณุนุฑุงุช ุงูุญุฑุงุฑูุฉ ุจูุงุกู ุนูู ุงูุญุฑูุฉ
        const calories = Math.floor((totalMotion * 0.01) + (repCount * 0.5));
        document.getElementById('caloriesBurned').textContent = calories;
        
        // ุชุญุฏูุซ ุงููุฏู ุชููุงุฆูุงู ูุน ุงูููุช
        if (elapsed > 60) {
            exerciseTarget = 30;
        } else if (elapsed > 30) {
            exerciseTarget = 25;
        }
        
        updateProgress();
    }, 1000);
}

function stopTrainingSession() {
    if (sessionTimer) {
        clearInterval(sessionTimer);
        sessionTimer = null;
    }
}

// ============ ูุธุงู ุญูุธ ุงูุชูุฏู ============
function saveWorkoutProgress() {
    if (repCount === 0) {
        showAlert('โ๏ธ ูุง ููุฌุฏ ุชูุฏู ูุญูุธู. ูู ุจุจุนุถ ุงูุชูุฑุงุฑุงุช ุฃููุงู.', 'warning');
        return;
    }
    
    const workout = {
        date: new Date().toLocaleDateString('ar-SA'),
        exercise: selectedExercise ? exercisePatterns[selectedExercise].name : "ุชูุฑูู ุนุงู",
        reps: repCount,
        accuracy: document.getElementById('accuracyScore').textContent,
        duration: document.getElementById('sessionTime').textContent,
        formScore: advancedMotionData.formScore,
        timestamp: new Date().toISOString()
    };
    
    workoutHistory.push(workout);
    
    // ุญูุธ ูู localStorage
    localStorage.setItem('workoutHistory', JSON.stringify(workoutHistory));
    
    // ุชุญุฏูุซ ุงูุฌุฏูู
    updateProgressTable();
    
    showAlert('โ ุชู ุญูุธ ุชูุฏูู ุงููููู ุจูุฌุงุญ!', 'success');
}

function updateProgressTable() {
    const tableBody = document.getElementById('progressTable');
    tableBody.innerHTML = '';
    
    // ุนุฑุถ ุขุฎุฑ 5 ุฌูุณุงุช
    const recentWorkouts = workoutHistory.slice(-5);
    
    if (recentWorkouts.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="5" style="padding: 20px; text-align: center; color: #ccc;">
                    <i class="fas fa-history"></i> ูุง ุชูุฌุฏ ุณุฌูุงุช ุณุงุจูุฉ
                </td>
            </tr>
        `;
        return;
    }
    
    recentWorkouts.forEach((workout, index) => {
        const row = document.createElement('tr');
        const evaluation = getEvaluation(workout.formScore);
        
        row.innerHTML = `
            <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: right;">
                ${workout.date}
            </td>
            <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: center;">
                ${workout.reps}
            </td>
            <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: center;">
                ${workout.accuracy}
            </td>
            <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: center;">
                ${workout.duration}
            </td>
            <td style="padding: 10px; border: 1px solid rgba(0,190,159,0.3); text-align: center;">
                <span style="color: ${getEvaluationColor(evaluation)}">${evaluation}</span>
            </td>
        `;
        
        tableBody.appendChild(row);
    });
}

function getEvaluation(score) {
    if (score >= 90) return 'ููุชุงุฒ';
    if (score >= 80) return 'ุฌูุฏ ุฌุฏุงู';
    if (score >= 70) return 'ุฌูุฏ';
    if (score >= 60) return 'ููุจูู';
    return 'ูุญุชุงุฌ ุชุญุณูู';
}

function getEvaluationColor(evaluation) {
    switch(evaluation) {
        case 'ููุชุงุฒ': return '#00ff00';
        case 'ุฌูุฏ ุฌุฏุงู': return '#00be9f';
        case 'ุฌูุฏ': return '#ffc107';
        case 'ููุจูู': return '#ff9800';
        default: return '#ff416c';
    }
}

function viewProgressHistory() {
    if (workoutHistory.length === 0) {
        showAlert('๐ ูุง ุชูุฌุฏ ุณุฌูุงุช ุชุฏุฑูุจ ุณุงุจูุฉ.', 'warning');
        return;
    }
    
    let historyText = "<strong>๐ ุณุฌู ุงูุชูุฏู ุงูุชุฏุฑูุจู:</strong><br><br>";
    
    workoutHistory.slice(-10).forEach((workout, index) => {
        historyText += `
            <div style="background: rgba(255,255,255,0.05); padding: 10px; margin: 5px 0; border-radius: 6px;">
                <strong>${workout.date}</strong><br>
                ${workout.exercise}: ${workout.reps} ุชูุฑุงุฑ - ${workout.duration} ุฏูููุฉ<br>
                ุงูุฏูุฉ: ${workout.accuracy} - ุงูุชูููู: <span style="color: ${getEvaluationColor(getEvaluation(workout.formScore))}">
                ${getEvaluation(workout.formScore)}</span>
            </div>
        `;
    });
    
    showFeedback(historyText);
    showAlert('๐ ูุชู ุนุฑุถ ุขุฎุฑ 10 ุฌูุณุงุช ุชุฏุฑูุจูุฉ');
}

// ============ ูุธุงุฆู ุงููุณุงุนุฏุฉ ============
function showFeedback(message) {
    const feedbackElement = document.getElementById('feedbackMessage');
    feedbackElement.innerHTML = message;
}

function showAlert(message, type = 'success') {
    const alertElement = document.getElementById('exerciseAlert');
    const messageElement = document.getElementById('alertMessage');
    
    messageElement.innerHTML = message;
    alertElement.className = `alert alert-${type}`;
    alertElement.style.display = 'block';
    
    // ุฅุฎูุงุก ุงูุชูุจูู ุจุนุฏ 5 ุซูุงูู
    setTimeout(() => {
        alertElement.style.display = 'none';
    }, 5000);
}

// ============ ูุธุงู ุชุณุฌูู ุงูุฏุฎูู ============
function logout() {
    localStorage.removeItem('loggedInUser');
    window.location.reload();
}

function redirectToLogin() {
    window.location.href = "login.html";
}

// ============ ุญูุงูุฉ ุงูุตูุญุฉ ุนูุฏ ุงูุฅุบูุงู ============
window.addEventListener('beforeunload', () => {
    if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
    }
    
    // ุญูุธ ุงูุชูุฏู
    if (repCount > 0) {
        const progress = {
            reps: repCount,
            accuracy: document.getElementById('accuracyScore').textContent,
            time: document.getElementById('sessionTime').textContent,
            date: new Date().toISOString()
        };
        localStorage.setItem('lastWorkout', JSON.stringify(progress));
    }
});
</script>
</body>
</html>